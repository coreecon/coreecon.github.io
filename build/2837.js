/*! For license information please see 2837.js.LICENSE.txt */
"use strict";(globalThis.webpackChunk_JUPYTERLAB_CORE_OUTPUT=globalThis.webpackChunk_JUPYTERLAB_CORE_OUTPUT||[]).push([[2837],{52837:(e,t,r)=>{r.r(t),r.d(t,{IServiceWorkerRegistrationWrapper:()=>c,JupyterLiteServer:()=>a,Router:()=>s,ServiceWorkerRegistrationWrapper:()=>h});var i=r(2132),n=r(76219),o=r(79988);class s{constructor(){this._routes=[]}get(e,t){this._add("GET",e,t)}put(e,t){this._add("PUT",e,t)}post(e,t){this._add("POST",e,t)}patch(e,t){this._add("PATCH",e,t)}delete(e,t){this._add("DELETE",e,t)}async route(e){const t=new URL(e.url),{method:r}=e,{pathname:i}=t;for(const n of this._routes){if(n.method!==r)continue;const o=i.match(n.pattern);if(!o)continue;const s=o.slice(1);let a;if("PATCH"===n.method||"PUT"===n.method||"POST"===n.method)try{a=JSON.parse(await e.text())}catch{a=void 0}return n.callback.call(null,{pathname:i,body:a,query:Object.fromEntries(t.searchParams)},...s)}throw new Error("Cannot route "+e.method+" "+e.url)}_add(e,t,r){"string"==typeof t&&(t=new RegExp(t)),this._routes.push({method:e,pattern:t,callback:r})}}class a extends n.M{constructor(e){var t;super(e),this.name="JupyterLite Server",this.namespace=this.name,this.version="unknown",this._router=new s,this._serviceManager=new i.ServiceManager({standby:"never",serverSettings:{...i.ServerConnection.makeSettings(),WebSocket:o.WebSocket,fetch:null!==(t=this.fetch.bind(this))&&void 0!==t?t:void 0}})}get router(){return this._router}get serviceManager(){return this._serviceManager}async fetch(e,t){if(!(e instanceof Request))throw Error("Request info is not a Request");return this._router.route(e)}attachShell(e){}evtResize(e){}registerPluginModule(e){let t=e.default;Object.prototype.hasOwnProperty.call(e,"__esModule")||(t=e),Array.isArray(t)||(t=[t]),t.forEach((e=>{try{this.registerPlugin(e)}catch(e){console.error(e)}}))}registerPluginModules(e){e.forEach((e=>{this.registerPluginModule(e)}))}}const c=new(r(92233).Token)("@jupyterlite/server-extension:IServiceWorkerRegistrationWrapper");var u=r(4947),l=r(86086);class h{constructor(){this._registration=null,this._registrationChanged=new u.Signal(this),this.initialize()}get registrationChanged(){return this._registrationChanged}get enabled(){return null!==this._registration}async initialize(){if("serviceWorker"in navigator||(console.error("ServiceWorker registration failed: Service Workers not supported in this browser"),this.setRegistration(null)),navigator.serviceWorker.controller){const e=await navigator.serviceWorker.getRegistration(navigator.serviceWorker.controller.scriptURL);e&&this.setRegistration(e)}return await navigator.serviceWorker.register(l.URLExt.join(l.PageConfig.getBaseUrl(),"services.js")).then((e=>{this.setRegistration(e)}),(e=>{console.error(`ServiceWorker registration failed: ${e}`),this.setRegistration(null)}))}setRegistration(e){this._registration=e,this._registrationChanged.emit(this._registration)}}},76219:(e,t,r)=>{r.d(t,{M:()=>a});var i,n=r(1514),o=r(92233),s=r(42051),a=function(){function e(e){this._started=!1,this._pluginMap=i.createPluginMap(),this._serviceMap=i.createServiceMap(),this._delegate=new o.PromiseDelegate;var t=new n.CommandRegistry,r=e.contextMenuRenderer,a=new s.ContextMenu({commands:t,renderer:r});this.commands=t,this.contextMenu=a,this.shell=e.shell}return Object.defineProperty(e.prototype,"started",{get:function(){return this._delegate.promise},enumerable:!0,configurable:!0}),e.prototype.getPluginDescription=function(e){var t=this._pluginMap[e];return t&&t.description||""},e.prototype.hasPlugin=function(e){return e in this._pluginMap},e.prototype.listPlugins=function(){return Object.keys(this._pluginMap)},e.prototype.registerPlugin=function(e){if(e.id in this._pluginMap)throw new Error("Plugin '"+e.id+"' is already registered.");var t=i.createPluginData(e);i.ensureNoCycle(t,this._pluginMap,this._serviceMap),t.provides&&this._serviceMap.set(t.provides,t.id),this._pluginMap[t.id]=t},e.prototype.registerPlugins=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];this.registerPlugin(i)}},e.prototype.activatePlugin=function(e){var t=this,r=this._pluginMap[e];if(!r)return Promise.reject(new Error("Plugin '"+e+"' is not registered."));if(r.activated)return Promise.resolve(void 0);if(r.promise)return r.promise;var i=r.requires.map((function(e){return t.resolveRequiredService(e)})),n=r.optional.map((function(e){return t.resolveOptionalService(e)})),o=i.concat(n);return r.promise=Promise.all(o).then((function(e){return r.activate.apply(void 0,function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<r;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,n++)i[n]=o[s];return i}([t],e))})).then((function(e){r.service=e,r.activated=!0,r.promise=null})).catch((function(e){throw r.promise=null,e})),r.promise},e.prototype.resolveRequiredService=function(e){var t=this._serviceMap.get(e);if(!t)return Promise.reject(new Error("No provider for: "+e.name+"."));var r=this._pluginMap[t];return r.activated?Promise.resolve(r.service):this.activatePlugin(t).then((function(){return r.service}))},e.prototype.resolveOptionalService=function(e){var t=this._serviceMap.get(e);if(!t)return Promise.resolve(null);var r=this._pluginMap[t];return r.activated?Promise.resolve(r.service):this.activatePlugin(t).then((function(){return r.service})).catch((function(e){return console.error(e),null}))},e.prototype.start=function(e){var t=this;if(void 0===e&&(e={}),this._started)return this._delegate.promise;this._started=!0;var r=e.hostID||"",n=i.collectStartupPlugins(this._pluginMap,e).map((function(e){return t.activatePlugin(e).catch((function(t){console.error("Plugin '"+e+"' failed to activate."),console.error(t)}))}));return Promise.all(n).then((function(){t.attachShell(r),t.addEventListeners(),t._delegate.resolve(void 0)})),this._delegate.promise},e.prototype.handleEvent=function(e){switch(e.type){case"resize":this.evtResize(e);break;case"keydown":this.evtKeydown(e);break;case"contextmenu":this.evtContextMenu(e)}},e.prototype.attachShell=function(e){s.Widget.attach(this.shell,e&&document.getElementById(e)||document.body)},e.prototype.addEventListeners=function(){document.addEventListener("contextmenu",this),document.addEventListener("keydown",this,!0),window.addEventListener("resize",this)},e.prototype.evtKeydown=function(e){this.commands.processKeydownEvent(e)},e.prototype.evtContextMenu=function(e){e.shiftKey||this.contextMenu.open(e)&&(e.preventDefault(),e.stopPropagation())},e.prototype.evtResize=function(e){this.shell.update()},e}();!function(e){e.createPluginMap=function(){return Object.create(null)},e.createServiceMap=function(){return new Map},e.createPluginData=function(e){return{id:e.id,description:e.description||"",service:null,promise:null,activated:!1,activate:e.activate,provides:e.provides||null,autoStart:e.autoStart||!1,requires:e.requires?e.requires.slice():[],optional:e.optional?e.optional.slice():[]}},e.ensureNoCycle=function(e,t,r){var i=e.requires.concat(e.optional);if(e.provides&&0!==i.length){var n=[e.id];if(i.some((function i(o){if(o===e.provides)return!0;var s=r.get(o);if(!s)return!1;var a=t[s],c=a.requires.concat(a.optional);return 0!==c.length&&(n.push(s),!!c.some(i)||(n.pop(),!1))})))throw new Error("Cycle detected: "+n.join(" -> ")+".")}},e.collectStartupPlugins=function(e,t){var r=Object.create(null);for(var i in e)e[i].autoStart&&(r[i]=!0);if(t.startPlugins)for(var n=0,o=t.startPlugins;n<o.length;n++)r[i=o[n]]=!0;if(t.ignorePlugins)for(var s=0,a=t.ignorePlugins;s<a.length;s++)delete r[i=a[s]];return Object.keys(r)}}(i||(i={}))}}]);