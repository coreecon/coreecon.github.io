"use strict";(globalThis.webpackChunk_JUPYTERLAB_CORE_OUTPUT=globalThis.webpackChunk_JUPYTERLAB_CORE_OUTPUT||[]).push([[4977],{24977:(e,t,n)=>{n.r(t),n.d(t,{CellTypeSwitcher:()=>pe,CommandEditStatus:()=>Se,ExecutionIndicator:()=>ct,ExecutionIndicatorComponent:()=>rt,INotebookTools:()=>nt,INotebookTracker:()=>ot,INotebookWidgetFactory:()=>tt,KernelError:()=>ce,Notebook:()=>Xe,NotebookActions:()=>he,NotebookModel:()=>ye,NotebookModelFactory:()=>be,NotebookPanel:()=>et,NotebookTools:()=>Ae,NotebookTracker:()=>st,NotebookTrustStatus:()=>at,NotebookWidgetFactory:()=>lt,StaticNotebook:()=>Ye,ToolbarItems:()=>ge});var o=n(37782),s=n(92233),i=n(4947),a=n(54344),l=n(12299);class d{constructor(e={}){if(this._map=new a.v,this._isDisposed=!1,this._stateChanged=new i.Signal(this),this._changed=new i.Signal(this),this._modelDB=null,this._serialized=null,this._changeGuard=!1,this.contentFactory=e.contentFactory||d.defaultContentFactory,e.values)for(const t of Object.keys(e.values))void 0!==e.values[t]&&this.set(t,e.values[t]);this._map.changed.connect(this._onMapChanged,this),e.modelDB&&(this._modelDB=e.modelDB,this._serialized=this._modelDB.createValue("attachments"),this._serialized.get()?this.fromJSON(this._serialized.get()):this._serialized.set(this.toJSON()),this._serialized.changed.connect(this._onSerializedChanged,this))}get stateChanged(){return this._stateChanged}get changed(){return this._changed}get keys(){return this._map.keys()}get length(){return this._map.keys().length}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,this._map.dispose(),i.Signal.clearData(this))}has(e){return this._map.has(e)}get(e){return this._map.get(e)}set(e,t){const n=this._createItem({value:t});this._map.set(e,n)}remove(e){this._map.delete(e)}clear(){this._map.values().forEach((e=>{e.dispose()})),this._map.clear()}fromJSON(e){this.clear(),Object.keys(e).forEach((t=>{void 0!==e[t]&&this.set(t,e[t])}))}toJSON(){const e={};for(const t of this._map.keys())e[t]=this._map.get(t).toJSON();return e}_createItem(e){const t=this.contentFactory.createAttachmentModel(e);return t.changed.connect(this._onGenericChange,this),t}_onMapChanged(e,t){this._serialized&&!this._changeGuard&&(this._changeGuard=!0,this._serialized.set(this.toJSON()),this._changeGuard=!1),this._changed.emit(t),this._stateChanged.emit(void 0)}_onSerializedChanged(e,t){this._changeGuard||(this._changeGuard=!0,this.fromJSON(t.newValue),this._changeGuard=!1)}_onGenericChange(){this._stateChanged.emit(void 0)}}!function(e){class t{createAttachmentModel(e){return new l.AttachmentModel(e)}}e.ContentFactory=t,e.defaultContentFactory=new t}(d||(d={}));class r{constructor(e){this._parent=e.parent||null,this._model=e.model}async resolveUrl(e){return this._parent&&!e.startsWith("attachment:")?this._parent.resolveUrl(e):e}async getDownloadUrl(e){if(this._parent&&!e.startsWith("attachment:"))return this._parent.getDownloadUrl(e);const t=e.slice("attachment:".length),n=this._model.get(t);if(void 0===n)return e;const{data:o}=n,s=Object.keys(o)[0];if(void 0===s||-1===l.imageRendererFactory.mimeTypes.indexOf(s))throw new Error(`Cannot render unknown image mime type "${s}".`);return`data:${s};base64,${o[s]}`}isLocal(e){var t,n,o;return!(this._parent&&!e.startsWith("attachment:"))||null===(o=null===(n=(t=this._parent).isLocal)||void 0===n?void 0:n.call(t,e))||void 0===o||o}}var c=n(42938),h=n(49634),u=n(73198);const g=h.M();function p(e){return"markdown"===e.type}function m(e){return"raw"===e.type}class C extends c.p.Model{constructor(e){var t;super({modelDB:e.modelDB,id:e.id||(null===(t=e.cell)||void 0===t?void 0:t.id)||s.UUID.uuid4()}),this.contentChanged=new i.Signal(this),this.stateChanged=new i.Signal(this),this.value.changed.connect(this.onGenericChange,this),this.modelDB.createValue("type").set(this.type);const n=this.modelDB.createMap("metadata");n.changed.connect(this.onModelDBMetadataChange,this),n.changed.connect(this.onGenericChange,this);const o=e.cell,a=this.modelDB.createValue("trusted");if(a.changed.connect(this.onTrustedChanged,this),!o)return void a.set(!1);a.set(!!o.metadata.trusted),delete o.metadata.trusted,Array.isArray(o.source)?this.value.text=o.source.map((e=>e.replace(/\r\n/g,"\n").replace(/\r/g,"\n"))).join(""):this.value.text=o.source.replace(/\r\n/g,"\n").replace(/\r/g,"\n");const l=s.JSONExt.deepCopy(o.metadata);"raw"!==this.type&&delete l.format,"code"!==this.type&&(delete l.collapsed,delete l.scrolled);for(const e in l)n.set(e,l[e])}get type(){return"raw"}get id(){return this.sharedModel.getId()}get metadata(){return this.modelDB.get("metadata")}get trusted(){return this.modelDB.getValue("trusted")}set trusted(e){this.trusted!==e&&this.modelDB.setValue("trusted",e)}toJSON(){const e=Object.create(null);for(const t of this.metadata.keys()){const n=JSON.parse(JSON.stringify(this.metadata.get(t)));e[t]=n}return this.trusted&&(e.trusted=!0),{cell_type:this.type,source:this.value.text,metadata:e}}onTrustedChanged(e,t){}switchSharedModel(e,t){if(t){const t=e.getMetadata();t&&this._updateModelDBMetadata(t)}super.switchSharedModel(e,t)}onModelDBMetadataChange(e,t){const n=this.sharedModel.getMetadata();g((()=>{switch(t.type){case"add":case"change":this._changeCellMetadata(n,t);break;case"remove":delete n[t.key];break;default:throw new Error(`Invalid event type: ${t.type}`)}this.sharedModel.setMetadata(n)}))}_changeCellMetadata(e,t){switch(t.key){case"jupyter":e.jupyter=t.newValue;break;case"collapsed":e.collapsed=t.newValue;break;case"name":e.name=t.newValue;break;case"scrolled":e.scrolled=t.newValue;break;case"tags":e.tags=t.newValue;break;case"trusted":e.trusted=t.newValue;break;default:e[t.key]=t.newValue}}_onSharedModelChanged(e,t){super._onSharedModelChanged(e,t),g((()=>{var e;if(t.metadataChange){const n=null===(e=t.metadataChange)||void 0===e?void 0:e.newValue;n&&this._updateModelDBMetadata(n)}}))}_updateModelDBMetadata(e){Object.keys(e).map((t=>{switch(t){case"collapsed":this.metadata.set("collapsed",e.jupyter);break;case"jupyter":this.metadata.set("jupyter",e.jupyter);break;case"name":this.metadata.set("name",e.name);break;case"scrolled":this.metadata.set("scrolled",e.scrolled);break;case"tags":this.metadata.set("tags",e.tags);break;case"trusted":this.metadata.set("trusted",e.trusted);break;default:this.metadata.set(t,e[t])}}))}onGenericChange(){this.contentChanged.emit(void 0)}}class _ extends C{constructor(e){super(e);const t=e.contentFactory||_.defaultContentFactory;let n;const o=e.cell;!o||"raw"!==o.cell_type&&"markdown"!==o.cell_type||(n=o.attachments),this._attachments=t.createAttachmentsModel({values:n,modelDB:this.modelDB}),this._attachments.stateChanged.connect(this.onGenericChange,this)}get attachments(){return this._attachments}toJSON(){const e=super.toJSON();return this.attachments.length&&(e.attachments=this.attachments.toJSON()),e}}!function(e){class t{createAttachmentsModel(e){return new d(e)}}e.ContentFactory=t,e.defaultContentFactory=new t}(_||(_={}));class v extends _{get type(){return"raw"}toJSON(){const e=super.toJSON();return e.id=this.id,e}}class f extends _{constructor(e){super(e),this.mimeType="text/x-ipythongfm"}get type(){return"markdown"}toJSON(){const e=super.toJSON();return e.id=this.id,e}}class y extends C{constructor(e){var t;super(e),this._executedCode="",this._isDirty=!1;const n=e.contentFactory||y.defaultContentFactory,o=this.trusted,s=e.cell;let i=[];const a=this.modelDB.createValue("executionCount");if(a.get()||(s&&"code"===s.cell_type?(a.set(s.execution_count||null),i=null!==(t=s.outputs)&&void 0!==t?t:[],null!=s.execution_count&&(this._executedCode=this.value.text.trim())):a.set(null)),this.value.changed.connect(this._onValueChanged,this),a.changed.connect(this._onExecutionCountChanged,this),g((()=>{this.sharedModel.setOutputs(i)})),this._outputs=n.createOutputArea({trusted:o,values:i}),this._outputs.changed.connect(this.onGenericChange,this),this._outputs.changed.connect(this.onModelDBOutputsChange,this),this.metadata.changed.connect(b.collapseChanged,this),this.metadata.has("collapsed")){const e=this.metadata.get("collapsed");b.collapseChanged(this.metadata,{type:"change",key:"collapsed",oldValue:e,newValue:e})}else if(this.metadata.has("jupyter")){const e=this.metadata.get("jupyter");e.hasOwnProperty("outputs_hidden")&&b.collapseChanged(this.metadata,{type:"change",key:"jupyter",oldValue:e,newValue:e})}}switchSharedModel(e,t){t&&(this.clearExecution(),e.getOutputs().forEach((e=>this._outputs.add(e)))),super.switchSharedModel(e,t)}get type(){return"code"}get executionCount(){return this.modelDB.has("executionCount")?this.modelDB.getValue("executionCount"):null}set executionCount(e){e!==this.executionCount&&this.modelDB.setValue("executionCount",e||null)}get isDirty(){return this._isDirty}_setDirty(e){e!==this._isDirty&&(e||(this._executedCode=this.value.text.trim()),this._isDirty=e,this.stateChanged.emit({name:"isDirty",oldValue:!e,newValue:e}))}clearExecution(){this.outputs.clear(),this.executionCount=null,this._setDirty(!1),this.metadata.delete("execution")}get outputs(){return this._outputs}dispose(){this.isDisposed||(this._outputs.dispose(),this._outputs=null,super.dispose())}toJSON(){const e=super.toJSON();return e.execution_count=this.executionCount||null,e.outputs=this.outputs.toJSON(),e.id=this.id,e}onTrustedChanged(e,t){this._outputs&&(this._outputs.trusted=t.newValue),this.stateChanged.emit({name:"trusted",oldValue:t.oldValue,newValue:t.newValue})}onModelDBOutputsChange(e,t){const n=this.sharedModel;g((()=>{switch(t.type){case"add":{const e=t.newValues.map((e=>e.toJSON()));n.updateOutputs(t.newIndex,t.newIndex+e.length,e);break}case"set":{const e=t.newValues.map((e=>e.toJSON()));n.updateOutputs(t.oldIndex,t.oldIndex+e.length,e);break}case"remove":n.updateOutputs(t.oldIndex,t.oldValues.length);break;default:throw new Error(`Invalid event type: ${t.type}`)}}))}_onValueChanged(){null!==this.executionCount&&this._setDirty(this._executedCode!==this.value.text.trim())}_onSharedModelChanged(e,t){super._onSharedModelChanged(e,t),g((()=>{t.outputsChange&&(this.clearExecution(),e.getOutputs().forEach((e=>this._outputs.add(e)))),t.executionCountChange&&(this.executionCount=t.executionCountChange.newValue?t.executionCountChange.newValue:null)}))}_onExecutionCountChanged(e,t){const n=this.sharedModel;g((()=>{n.execution_count=t.newValue?t.newValue:null})),this.contentChanged.emit(void 0),this.stateChanged.emit({name:"executionCount",oldValue:t.oldValue,newValue:t.newValue}),t.newValue&&this.isDirty&&this._setDirty(!1)}}var b;!function(e){class t{createOutputArea(e){return new u.OutputAreaModel(e)}}e.ContentFactory=t,e.defaultContentFactory=new t}(y||(y={})),function(e){e.collapseChanged=function(e,t){if("collapsed"===t.key){const n=e.get("jupyter")||{},{outputs_hidden:o}=n,s=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(n[o[s]]=e[o[s]])}return n}(n,["outputs_hidden"]);o!==t.newValue&&(void 0!==t.newValue&&(s.outputs_hidden=t.newValue),0===Object.keys(s).length?e.delete("jupyter"):e.set("jupyter",s))}else if("jupyter"===t.key){const n=t.newValue||{};n.hasOwnProperty("outputs_hidden")?e.set("collapsed",n.outputs_hidden):e.delete("collapsed")}}}(b||(b={}));var w=n(48085),k=n(59110),S=n(24643),x=n(23203),O=n(82361),E=n(42051),M=n(94812),D=n(97505),N=n.n(D);class I extends o.ReactWidget{constructor(){super(),this.addClass("jp-Collapser")}get collapsed(){return!1}render(){return D.createElement("div",{className:"jp-Collapser-child",onClick:e=>this.handleClick(e)})}}class A extends I{constructor(){super(),this.addClass("jp-InputCollapser")}get collapsed(){var e;const t=null===(e=this.parent)||void 0===e?void 0:e.parent;return!!t&&t.inputHidden}handleClick(e){var t;const n=null===(t=this.parent)||void 0===t?void 0:t.parent;n&&(n.inputHidden=!n.inputHidden),this.update()}}class T extends I{constructor(){super(),this.addClass("jp-OutputCollapser")}get collapsed(){var e;const t=null===(e=this.parent)||void 0===e?void 0:e.parent;return!!t&&t.outputHidden}handleClick(e){var t,n;const o=null===(t=this.parent)||void 0===t?void 0:t.parent;if(o&&(o.outputHidden=!o.outputHidden,o.outputHidden)){let e=null===(n=o.parent)||void 0===n?void 0:n.node;e&&M.ElementExt.scrollIntoViewIfNeeded(e,o.node)}this.update()}}class F extends E.Widget{constructor(){super(),this.addClass("jp-CellHeader")}}class j extends E.Widget{constructor(){super(),this.addClass("jp-CellFooter")}}const R="jp-mod-has-primary-selection",P="jp-mod-in-leading-whitespace",B="jp-mod-dropTarget",L=/^\s+$/;class V extends E.Widget{constructor(e){super(),this._hasRefreshedSinceAttach=!1,(this.editor=e.factory({host:this.node,model:e.model,uuid:e.uuid,config:e.config,selectionStyle:e.selectionStyle})).model.selections.changed.connect(this._onSelectionsChanged,this),this._updateOnShow=!1!==e.updateOnShow}get model(){return this.editor.model}dispose(){this.isDisposed||(super.dispose(),this.editor.dispose())}handleEvent(e){switch(e.type){case"lm-dragenter":this._evtDragEnter(e);break;case"lm-dragleave":this._evtDragLeave(e);break;case"lm-dragover":this._evtDragOver(e);break;case"lm-drop":this._evtDrop(e)}}onActivateRequest(e){this.editor.focus()}onAfterAttach(e){super.onAfterAttach(e);const t=this.node;t.addEventListener("lm-dragenter",this),t.addEventListener("lm-dragleave",this),t.addEventListener("lm-dragover",this),t.addEventListener("lm-drop",this),this._hasRefreshedSinceAttach=!1,this.isVisible&&this.update()}onBeforeDetach(e){const t=this.node;t.removeEventListener("lm-dragenter",this),t.removeEventListener("lm-dragleave",this),t.removeEventListener("lm-dragover",this),t.removeEventListener("lm-drop",this)}onAfterShow(e){!this._updateOnShow&&this._hasRefreshedSinceAttach||this.update()}onResize(e){e.width>=0&&e.height>=0?this.editor.setSize(e):this.isVisible&&this.editor.resizeToFit()}onUpdateRequest(e){this.isVisible&&(this._hasRefreshedSinceAttach=!0,this.editor.refresh())}_onSelectionsChanged(){const{start:e,end:t}=this.editor.getSelection();e.column!==t.column||e.line!==t.line?(this.addClass(R),this.removeClass(P)):(this.removeClass(R),this.editor.getLine(t.line).slice(0,t.column).match(L)?this.addClass(P):this.removeClass(P))}_evtDragEnter(e){!0!==this.editor.getOption("readOnly")&&void 0!==H.findTextData(e.mimeData)&&(e.preventDefault(),e.stopPropagation(),this.addClass("jp-mod-dropTarget"))}_evtDragLeave(e){this.removeClass(B),!0!==this.editor.getOption("readOnly")&&void 0!==H.findTextData(e.mimeData)&&(e.preventDefault(),e.stopPropagation())}_evtDragOver(e){this.removeClass(B),!0!==this.editor.getOption("readOnly")&&void 0!==H.findTextData(e.mimeData)&&(e.preventDefault(),e.stopPropagation(),e.dropAction="copy",this.addClass(B))}_evtDrop(e){if(!0===this.editor.getOption("readOnly"))return;const t=H.findTextData(e.mimeData);if(void 0===t)return;const n={top:e.y,bottom:e.y,left:e.x,right:e.x,x:e.x,y:e.y,width:0,height:0},o=this.editor.getPositionForCoordinate(n);if(null===o)return;if(this.removeClass(B),e.preventDefault(),e.stopPropagation(),"none"===e.proposedAction)return void(e.dropAction="none");const s=this.editor.getOffsetAt(o);this.model.value.insert(s,t)}}var H;!function(e){e.findTextData=function(e){const t=e.types().find((e=>0===e.indexOf("text")));if(void 0!==t)return e.getData(t)}}(H||(H={}));var W=n(79112);class J extends E.Widget{constructor(e){super(),this.addClass("jp-InputArea");const t=this.model=e.model,n=this.contentFactory=e.contentFactory||J.defaultContentFactory,o=this._prompt=n.createInputPrompt();o.addClass("jp-InputArea-prompt");const s={model:t,factory:n.editorFactory,updateOnShow:e.updateOnShow},i=this._editor=new V(s);i.addClass("jp-InputArea-editor");const a=this.layout=new E.PanelLayout;a.addWidget(o),e.placeholder||a.addWidget(i)}get editorWidget(){return this._editor}get editor(){return this._editor.editor}get promptNode(){return this._prompt.node}get renderedInput(){return this._rendered}renderInput(e){const t=this.layout;this._rendered&&(this._rendered.parent=null),this._editor.hide(),this._rendered=e,t.addWidget(e)}showEditor(){this._rendered&&(this._rendered.parent=null),this._editor.show()}setPrompt(e){this._prompt.executionCount=e}dispose(){this.isDisposed||(this._prompt=null,this._editor=null,this._rendered=null,super.dispose())}}!function(e){class t{constructor(t={}){this._editor=t.editorFactory||e.defaultEditorFactory}get editorFactory(){return this._editor}createInputPrompt(){return new U}}e.ContentFactory=t,e.defaultEditorFactory=(new W.rM).newInlineEditor,e.defaultContentFactory=new t({})}(J||(J={}));class U extends E.Widget{constructor(){super(),this._executionCount=null,this.addClass("jp-InputPrompt")}get executionCount(){return this._executionCount}set executionCount(e){this._executionCount=e,this.node.textContent=null===e?" ":`[${e||" "}]:`}}const z="jp-Placeholder-content";class G extends o.ReactWidget{constructor(e){super(),this.addClass("jp-Placeholder"),this._callback=e}handleClick(e){(0,this._callback)(e)}}class $ extends G{constructor(e){super(e),this.addClass("jp-InputPlaceholder")}render(){return[D.createElement("div",{className:"jp-Placeholder-prompt jp-InputPrompt",key:"input"}),D.createElement("div",{className:z,onClick:e=>this.handleClick(e),key:"content"},D.createElement(S.ellipsesIcon.react,{className:"jp-MoreHorizIcon",elementPosition:"center",height:"auto",width:"32px"}))]}}class K extends G{constructor(e){super(e),this.addClass("jp-OutputPlaceholder")}render(){return[D.createElement("div",{className:"jp-Placeholder-prompt jp-OutputPrompt",key:"output"}),D.createElement("div",{className:z,onClick:e=>this.handleClick(e),key:"content"},D.createElement(S.ellipsesIcon.react,{className:"jp-MoreHorizIcon",elementPosition:"center",height:"auto",width:"32px"}))]}}const q="jp-mod-resizedCell";class Y extends E.Widget{constructor(e){super(),this.targetNode=e,this._isActive=!1,this._isDragging=!1,this._protectedWidth=10,this.addClass("jp-CellResizeHandle")}onAfterAttach(e){super.onAfterAttach(e),this.node.addEventListener("dblclick",this),this.node.addEventListener("mousedown",this)}onAfterDetach(e){super.onAfterAttach(e),this.node.removeEventListener("dblclick",this),this.node.removeEventListener("mousedown",this)}handleEvent(e){var t,n;switch(e.type){case"dblclick":null===(t=this.targetNode.parentNode)||void 0===t||t.childNodes.forEach((e=>{e.classList.remove(q)})),document.documentElement.style.setProperty("--jp-side-by-side-output-size","1fr"),this._isActive=!1;break;case"mousedown":this._isDragging=!0,this._isActive||(null===(n=this.targetNode.parentNode)||void 0===n||n.childNodes.forEach((e=>{e.classList.add(q)})),this._isActive=!0),window.addEventListener("mousemove",this),window.addEventListener("mouseup",this);break;case"mousemove":{if(!this._isActive||!this._isDragging)return;const t=this.targetNode.getBoundingClientRect(),n=(t.width-2*this._protectedWidth)/(e.clientX-t.x-this._protectedWidth)-1;document.documentElement.style.setProperty("--jp-side-by-side-output-size",`${n}fr`);break}case"mouseup":this._isDragging=!1,window.removeEventListener("mousemove",this),window.removeEventListener("mouseup",this)}}}const X="jp-mod-dirty",Q="jp-MarkdownHeadingCollapsed",Z="jp-collapseHeadingButton",ee="jp-mod-rendered",te="jp-mod-noOutputs",ne="application/x-jupyter-icontentsrich";class oe extends E.Widget{constructor(e){super(),this._displayChanged=new i.Signal(this),this._readOnly=!1,this._inputHidden=!1,this._syncCollapse=!1,this._syncEditable=!1,this._resizeDebouncer=new O.Debouncer((()=>{this._displayChanged.emit()}),0),this.addClass("jp-Cell");const t=this._model=e.model,n=this.contentFactory=e.contentFactory||oe.defaultContentFactory;this.layout=new E.PanelLayout;const o=n.createCellHeader();o.addClass("jp-Cell-header"),this.layout.addWidget(o);const s=this._inputWrapper=new E.Panel;s.addClass("jp-Cell-inputWrapper");const a=new A;a.addClass("jp-Cell-inputCollapser");const l=this._input=new J({model:t,contentFactory:n,updateOnShow:e.updateEditorOnShow,placeholder:e.placeholder});l.addClass("jp-Cell-inputArea"),s.addWidget(a),s.addWidget(l),this.layout.addWidget(s),this._inputPlaceholder=new $((()=>{this.inputHidden=!this.inputHidden}));const d=this.contentFactory.createCellFooter();d.addClass("jp-Cell-footer"),this.layout.addWidget(d),e.editorConfig&&this.editor.setOptions(Object.assign({},e.editorConfig)),t.metadata.changed.connect(this.onMetadataChanged,this)}initializeState(){return this.loadCollapseState(),this.loadEditableState(),this}get displayChanged(){return this._displayChanged}get promptNode(){return this._inputHidden?this._inputPlaceholder.node.firstElementChild:this._input.promptNode}get editorWidget(){return this._input.editorWidget}get editor(){return this._input.editor}get model(){return this._model}get inputArea(){return this._input}get readOnly(){return this._readOnly}set readOnly(e){e!==this._readOnly&&(this._readOnly=e,this.syncEditable&&this.saveEditableState(),this.update())}saveEditableState(){const{metadata:e}=this.model,t=e.get("editable");this.readOnly&&!1===t||!this.readOnly&&void 0===t||(this.readOnly?this.model.metadata.set("editable",!1):this.model.metadata.delete("editable"))}loadEditableState(){this.readOnly=!1===this.model.metadata.get("editable")}get ready(){return Promise.resolve(void 0)}setPrompt(e){this._input.setPrompt(e)}get inputHidden(){return this._inputHidden}set inputHidden(e){if(this._inputHidden===e)return;const t=this._inputWrapper.layout;e?(this._input.parent=null,t.addWidget(this._inputPlaceholder)):(this._inputPlaceholder.parent=null,t.addWidget(this._input)),this._inputHidden=e,this.syncCollapse&&this.saveCollapseState(),this.handleInputHidden(e)}saveCollapseState(){const e=Object.assign({},this.model.metadata.get("jupyter"));this.inputHidden&&!0===e.source_hidden||!this.inputHidden&&void 0===e.source_hidden||(this.inputHidden?e.source_hidden=!0:delete e.source_hidden,0===Object.keys(e).length?this.model.metadata.delete("jupyter"):this.model.metadata.set("jupyter",e))}loadCollapseState(){const e=this.model.metadata.get("jupyter")||{};this.inputHidden=!!e.source_hidden}handleInputHidden(e){}get syncCollapse(){return this._syncCollapse}set syncCollapse(e){this._syncCollapse!==e&&(this._syncCollapse=e,e&&this.loadCollapseState())}get syncEditable(){return this._syncEditable}set syncEditable(e){this._syncEditable!==e&&(this._syncEditable=e,e&&this.loadEditableState())}clone(){return new(0,this.constructor)({model:this.model,contentFactory:this.contentFactory,placeholder:!1})}dispose(){this.isDisposed||(this._resizeDebouncer.dispose(),this._input=null,this._model=null,this._inputWrapper=null,this._inputPlaceholder=null,super.dispose())}onAfterAttach(e){this.update()}onActivateRequest(e){this.editor.focus()}onFitRequest(e){this.editor.refresh()}onResize(e){this._resizeDebouncer.invoke()}onUpdateRequest(e){this._model&&this.editor.getOption("readOnly")!==this._readOnly&&(this.editor.setOption("readOnly",this._readOnly),this.toggleClass("jp-mod-readOnly",this._readOnly))}onMetadataChanged(e,t){switch(t.key){case"jupyter":this.syncCollapse&&this.loadCollapseState();break;case"editable":this.syncEditable&&this.loadEditableState()}}}!function(e){class t{constructor(e={}){this._editorFactory=e.editorFactory||J.defaultEditorFactory}get editorFactory(){return this._editorFactory}createCellHeader(){return new F}createCellFooter(){return new j}createInputPrompt(){return new U}createOutputPrompt(){return new u.OutputPrompt}createStdin(e){return new u.Stdin(e)}}e.ContentFactory=t,e.defaultContentFactory=new t}(oe||(oe={}));class se extends oe{constructor(e){super(e),this._outputHidden=!1,this._syncScrolled=!1,this._savingMetadata=!1,this.addClass("jp-CodeCell");const t=this._rendermime=e.rendermime,n=this.contentFactory,o=this.model;if(!e.placeholder){const s=this._outputWrapper=new E.Panel;s.addClass("jp-Cell-outputWrapper");const i=new T;i.addClass("jp-Cell-outputCollapser");const a=this._output=new u.OutputArea({model:o.outputs,rendermime:t,contentFactory:n,maxNumberOutputs:e.maxNumberOutputs});a.addClass("jp-Cell-outputArea"),0===o.outputs.length&&this.addClass(te),a.outputLengthChanged.connect(this._outputLengthHandler,this),s.addWidget(i),s.addWidget(a),this.layout.insertWidget(2,new Y(this.node)),this.layout.insertWidget(3,s),o.isDirty&&this.addClass(X),this._outputPlaceholder=new K((()=>{this.outputHidden=!this.outputHidden}))}o.stateChanged.connect(this.onStateChanged,this)}initializeState(){return super.initializeState(),this.loadScrolledState(),this.setPrompt(`${this.model.executionCount||""}`),this}get outputArea(){return this._output}get outputHidden(){return this._outputHidden}set outputHidden(e){if(this._outputHidden===e)return;const t=this._outputWrapper.layout;e?(t.removeWidget(this._output),t.addWidget(this._outputPlaceholder),this.inputHidden&&!this._outputWrapper.isHidden&&this._outputWrapper.hide()):(this._outputWrapper.isHidden&&this._outputWrapper.show(),t.removeWidget(this._outputPlaceholder),t.addWidget(this._output)),this._outputHidden=e,this.syncCollapse&&this.saveCollapseState()}saveCollapseState(){this._savingMetadata=!0;try{super.saveCollapseState();const e=this.model.metadata,t=this.model.metadata.get("collapsed");if(this.outputHidden&&!0===t||!this.outputHidden&&void 0===t)return;this.outputHidden?e.set("collapsed",!0):e.delete("collapsed")}finally{this._savingMetadata=!1}}loadCollapseState(){super.loadCollapseState(),this.outputHidden=!!this.model.metadata.get("collapsed")}get outputsScrolled(){return this._outputsScrolled}set outputsScrolled(e){this.toggleClass("jp-mod-outputsScrolled",e),this._outputsScrolled=e,this.syncScrolled&&this.saveScrolledState()}saveScrolledState(){const{metadata:e}=this.model,t=e.get("scrolled");this.outputsScrolled&&!0===t||!this.outputsScrolled&&void 0===t||(this.outputsScrolled?e.set("scrolled",!0):e.delete("scrolled"))}loadScrolledState(){const e=this.model.metadata;"auto"===e.get("scrolled")?this.outputsScrolled=!1:this.outputsScrolled=!!e.get("scrolled")}get syncScrolled(){return this._syncScrolled}set syncScrolled(e){this._syncScrolled!==e&&(this._syncScrolled=e,e&&this.loadScrolledState())}handleInputHidden(e){!e&&this._outputWrapper.isHidden?this._outputWrapper.show():e&&!this._outputWrapper.isHidden&&this._outputHidden&&this._outputWrapper.hide()}clone(){return new(0,this.constructor)({model:this.model,contentFactory:this.contentFactory,rendermime:this._rendermime,placeholder:!1})}cloneOutputArea(){return new u.SimplifiedOutputArea({model:this.model.outputs,contentFactory:this.contentFactory,rendermime:this._rendermime})}dispose(){this.isDisposed||(this._output.outputLengthChanged.disconnect(this._outputLengthHandler,this),this._rendermime=null,this._output=null,this._outputWrapper=null,this._outputPlaceholder=null,super.dispose())}onStateChanged(e,t){switch(t.name){case"executionCount":this.setPrompt(`${e.executionCount||""}`);break;case"isDirty":e.isDirty?this.addClass(X):this.removeClass(X)}}onMetadataChanged(e,t){if(!this._savingMetadata){switch(t.key){case"scrolled":this.syncScrolled&&this.loadScrolledState();break;case"collapsed":this.syncCollapse&&this.loadCollapseState()}super.onMetadataChanged(e,t)}}_outputLengthHandler(e,t){const n=0===t;this.toggleClass(te,n)}}!function(e){e.execute=async function(e,t,n){var o;const s=e.model,i=s.value.text;if(!i.trim()||!(null===(o=t.session)||void 0===o?void 0:o.kernel))return void s.clearExecution();const a={cellId:s.id};n=Object.assign(Object.assign(Object.assign({},s.metadata.toJSON()),n),a);const{recordTiming:l}=n;let d;s.clearExecution(),e.outputHidden=!1,e.setPrompt("*"),s.trusted=!0;try{const o=u.OutputArea.execute(i,e.outputArea,t,n);if(l){const t=e=>{let t;switch(e.header.msg_type){case"status":t=`status.${e.content.execution_state}`;break;case"execute_input":t="execute_input";break;default:return!0}const n=e.header.date||(new Date).toISOString(),o=Object.assign({},s.metadata.get("execution"));return o[`iopub.${t}`]=n,s.metadata.set("execution",o),!0};e.outputArea.future.registerMessageHook(t)}else s.metadata.delete("execution");d=e.outputArea.future;const a=await o;if(s.executionCount=a.content.execution_count,l){const e=Object.assign({},s.metadata.get("execution")),t=a.metadata.started;t&&(e["shell.execute_reply.started"]=t);const n=a.header.date;e["shell.execute_reply"]=n||(new Date).toISOString(),s.metadata.set("execution",e)}return a}catch(t){throw d&&!e.isDisposed&&e.outputArea.future===d&&e.setPrompt(""),t}}}(se||(se={}));class ie extends oe{handleEvent(e){switch(e.type){case"paste":this._evtPaste(e);break;case"dragenter":case"dragover":e.preventDefault();break;case"drop":this._evtNativeDrop(e);break;case"lm-dragover":this._evtDragOver(e);break;case"lm-drop":this._evtDrop(e)}}onAfterAttach(e){super.onAfterAttach(e);const t=this.node;t.addEventListener("lm-dragover",this),t.addEventListener("lm-drop",this),t.addEventListener("dragenter",this),t.addEventListener("dragover",this),t.addEventListener("drop",this),t.addEventListener("paste",this)}onBeforeDetach(e){const t=this.node;t.removeEventListener("drop",this),t.removeEventListener("dragover",this),t.removeEventListener("dragenter",this),t.removeEventListener("paste",this),t.removeEventListener("lm-dragover",this),t.removeEventListener("lm-drop",this)}_evtDragOver(e){(0,x.some)(l.imageRendererFactory.mimeTypes,(t=>!!e.mimeData.hasData(ne)&&e.mimeData.getData(ne).model.mimetype===t))&&(e.preventDefault(),e.stopPropagation(),e.dropAction=e.proposedAction)}_evtPaste(e){if(e.clipboardData){const t=e.clipboardData.items;for(let n=0;n<t.length;n++){if("text/plain"===t[n].type){if(n<t.length-1&&"file"===t[n+1].kind)continue;t[n].getAsString((e=>{var t,n;null===(n=(t=this.editor).replaceSelection)||void 0===n||n.call(t,e)}))}this._attachFiles(e.clipboardData.items)}}e.preventDefault()}_evtNativeDrop(e){e.dataTransfer&&this._attachFiles(e.dataTransfer.items),e.preventDefault()}_evtDrop(e){const t=(0,x.toArray)((0,x.filter)(e.mimeData.types(),(t=>{if(t===ne){const t=e.mimeData.getData(ne);return-1!==l.imageRendererFactory.mimeTypes.indexOf(t.model.mimetype)}return-1!==l.imageRendererFactory.mimeTypes.indexOf(t)})));if(0!==t.length)if(e.preventDefault(),e.stopPropagation(),"none"!==e.proposedAction){e.dropAction="copy";for(const n of t)if(n===ne){const{model:t,withContent:n}=e.mimeData.getData(ne);if("file"===t.type){const e=this._generateURI(t.name);this.updateCellSourceWithAttachment(t.name,e),n().then((t=>{this.model.attachments.set(e,{[t.mimetype]:t.content})}))}}else{const t=this._generateURI();this.model.attachments.set(t,{[n]:e.mimeData.getData(n)}),this.updateCellSourceWithAttachment(t,t)}}else e.dropAction="none"}_attachFiles(e){for(let t=0;t<e.length;t++){const n=e[t];if("file"===n.kind){const e=n.getAsFile();e&&this._attachFile(e)}}}_attachFile(e){const t=new FileReader;t.onload=n=>{const{href:o,protocol:s}=k.URLExt.parse(t.result);if("data:"!==s)return;const i=/([\w+\/\+]+)?(?:;(charset=[\w\d-]*|base64))?,(.*)/.exec(o);if(!i||4!==i.length)return;const a=i[1],l={[a]:i[3]},d=this._generateURI(e.name);a.startsWith("image/")&&(this.model.attachments.set(d,l),this.updateCellSourceWithAttachment(e.name,d))},t.onerror=t=>{console.error(`Failed to attach ${e.name}`+t)},t.readAsDataURL(e)}_generateURI(e=""){const t=e.lastIndexOf(".");return-1!==t?s.UUID.uuid4().concat(e.substring(t)):s.UUID.uuid4()}}class ae extends ie{constructor(e){var t,n,o;super(e),this._toggleCollapsedSignal=new i.Signal(this),this._renderer=null,this._rendered=!0,this._prevText="",this._ready=new s.PromiseDelegate,this._showEditorForReadOnlyMarkdown=!0,this.addClass("jp-MarkdownCell"),this._rendermime=e.rendermime.clone({resolver:new r({parent:null!==(t=e.rendermime.resolver)&&void 0!==t?t:void 0,model:this.model.attachments})}),this.editor.setOption("handlePaste",!1),this._headingCollapsed=null!==(n=this.model.metadata.get(Q))&&void 0!==n&&n,this._monitor=new k.ActivityMonitor({signal:this.model.contentChanged,timeout:1e3}),this._monitor.activityStopped.connect((()=>{this._rendered&&this.update()}),this),this._updateRenderedInput().then((()=>{this._ready.resolve(void 0)})),this.renderCollapseButtons(this._renderer),this.renderInput(this._renderer),this._showEditorForReadOnlyMarkdown=null!==(o=e.showEditorForReadOnlyMarkdown)&&void 0!==o?o:ae.defaultShowEditorForReadOnlyMarkdown}get ready(){return this._ready.promise}get headingInfo(){let e=this.model.value.text;const t=w.TU.lexer(e);let n;for(n of t){if("heading"===n.type)return{text:n.text,level:n.depth};if("html"===n.type){let e=n.raw.match(/<h([1-6])(.*?)>(.*?)<\/h\1>/);return(null==e?void 0:e[3])?{text:e[3],level:parseInt(e[1])}:{text:"",level:-1}}}return{text:"",level:-1}}get headingCollapsed(){return this._headingCollapsed}set headingCollapsed(e){this._headingCollapsed=e,e?this.model.metadata.set(Q,e):this.model.metadata.has(Q)&&this.model.metadata.delete(Q);const t=this.inputArea.promptNode.getElementsByClassName(Z)[0];t&&(e?t.classList.add("jp-mod-collapsed"):t.classList.remove("jp-mod-collapsed")),this.renderCollapseButtons(this._renderer)}get numberChildNodes(){return this._numberChildNodes}set numberChildNodes(e){this._numberChildNodes=e,this.renderCollapseButtons(this._renderer)}get toggleCollapsedSignal(){return this._toggleCollapsedSignal}get rendered(){return this._rendered}set rendered(e){this.readOnly&&!1===this._showEditorForReadOnlyMarkdown&&(e=!0),e!==this._rendered&&(this._rendered=e,this._handleRendered(),this._rendered||this.editor.refresh(),this._displayChanged.emit())}get showEditorForReadOnly(){return this._showEditorForReadOnlyMarkdown}set showEditorForReadOnly(e){this._showEditorForReadOnlyMarkdown=e,!1===e&&(this.rendered=!0)}dispose(){this.isDisposed||(this._monitor.dispose(),super.dispose())}maybeCreateCollapseButton(){if(this.headingInfo.level>0&&0==this.inputArea.promptNode.getElementsByClassName(Z).length){let e=this.inputArea.promptNode.appendChild(document.createElement("button"));e.className="jp-Button jp-collapseHeadingButton",e.setAttribute("data-heading-level",this.headingInfo.level.toString()),this._headingCollapsed?e.classList.add("jp-mod-collapsed"):e.classList.remove("jp-mod-collapsed"),e.onclick=e=>{this.headingCollapsed=!this.headingCollapsed,this._toggleCollapsedSignal.emit(this._headingCollapsed)}}}maybeCreateOrUpdateExpandButton(){var e,t;const n=this.node.getElementsByClassName("jp-showHiddenCellsButton");if(this.headingCollapsed&&0===n.length&&this._numberChildNodes>0){const e=document.createElement("button");e.className="bp3-button bp3-minimal jp-Button jp-showHiddenCellsButton",S.addIcon.render(e);const t=document.createElement("div");t.nodeValue=`${this._numberChildNodes} cell${this._numberChildNodes>1?"s":""} hidden`,e.appendChild(t),e.onclick=()=>{this.headingCollapsed=!1,this._toggleCollapsedSignal.emit(this._headingCollapsed)},this.node.appendChild(e)}else if((null===(t=null===(e=null==n?void 0:n[0])||void 0===e?void 0:e.childNodes)||void 0===t?void 0:t.length)>1)if(this._headingCollapsed)n[0].childNodes[1].textContent=`${this._numberChildNodes} cell${this._numberChildNodes>1?"s":""} hidden`;else for(const e of n)this.node.removeChild(e)}renderCollapseButtons(e){this.node.classList.toggle(Q,this._headingCollapsed),this.maybeCreateCollapseButton(),this.maybeCreateOrUpdateExpandButton()}renderInput(e){this.addClass(ee),this.renderCollapseButtons(e),this.inputArea.renderInput(e)}showEditor(){this.removeClass(ee),this.inputArea.showEditor()}onUpdateRequest(e){this._handleRendered(),super.onUpdateRequest(e)}updateCellSourceWithAttachment(e,t){var n,o;const s=`![${e}](attachment:${null!=t?t:e})`;null===(o=(n=this.editor).replaceSelection)||void 0===o||o.call(n,s)}_handleRendered(){this._rendered?(this._updateRenderedInput(),this.renderInput(this._renderer)):this.showEditor()}_updateRenderedInput(){const e=this.model,t=e&&e.value.text||"Type Markdown and LaTeX: $ α^2 $";if(t!==this._prevText){const e=new l.MimeModel({data:{"text/markdown":t}});return this._renderer||(this._renderer=this._rendermime.createRenderer("text/markdown"),this._renderer.addClass("jp-MarkdownOutput")),this._prevText=t,this._renderer.renderModel(e)}return Promise.resolve(void 0)}clone(){return new(0,this.constructor)({model:this.model,contentFactory:this.contentFactory,rendermime:this._rendermime,placeholder:!1})}}!function(e){e.defaultShowEditorForReadOnlyMarkdown=!0}(ae||(ae={}));class le extends oe{constructor(e){super(e),this.addClass("jp-RawCell")}clone(){return new(0,this.constructor)({model:this.model,contentFactory:this.contentFactory,placeholder:!1})}}var de=n(56956);const re="application/vnd.jupyter.cells";class ce extends Error{constructor(e){const t=e,n=t.ename,o=t.evalue;super(`KernelReplyNotOK: ${n} ${o}`),this.errorName=n,this.errorValue=o,this.traceback=t.traceback,Object.setPrototypeOf(this,ce.prototype)}}class he{static get executed(){return ue.executed}static get executionScheduled(){return ue.executionScheduled}static get selectionExecuted(){return ue.selectionExecuted}constructor(){}}var ue,ge;!function(e){function t(e,t="below",n,o=!1){if(!e.model||!e.activeCell)return;const s=ue.getState(e),i=e.model;e.mode="command";const a=n.map((t=>{switch(t.cell_type){case"code":if("cut"===e.lastClipboardInteraction&&"string"==typeof t.id){let e=t.id;return i.contentFactory.createCodeCell({id:e,cell:t})}return i.contentFactory.createCodeCell({cell:t});case"markdown":return i.contentFactory.createMarkdownCell({cell:t});default:return i.contentFactory.createRawCell({cell:t})}})),l=e.model.cells;let d;switch(l.beginCompoundOperation(),t){case"below":d=e.activeCellIndex;break;case"belowSelected":e.widgets.forEach(((t,n)=>{e.isSelectedOrActive(t)&&(d=n)}));break;case"above":d=e.activeCellIndex-1;break;case"replace":{const t=[];e.widgets.forEach(((n,o)=>{const s=!1!==n.model.metadata.get("deletable");e.isSelectedOrActive(n)&&s&&t.push(o)})),t.length>0&&t.reverse().forEach((e=>{l.remove(e)})),d=t[0];break}}a.forEach((e=>{l.insert(++d,e)})),l.endCompoundOperation(),e.activeCellIndex+=a.length,e.deselectAll(),o&&(e.lastClipboardInteraction="paste"),ue.handleState(e,s)}function n(t,n,o){const s=(0,x.findIndex)(o.widgets,((e,n)=>t.model.id===e.model.id));if(-1===s)return-1;if(!o.widgets.length)return s+1;let i=e.getHeadingInfo(t);if(t.isHidden||!(t instanceof ae)||!i.isHeading)return s+1;let a,l=!1,d=0;for(a=s+1;a<o.widgets.length;a++){let t=o.widgets[a],s=e.getHeadingInfo(t);if(s.isHeading&&s.headingLevel<=i.headingLevel){a-=1;break}l&&s.isHeading&&s.headingLevel<=d&&(l=!1),n||l?t.setHidden(!0):(s.collapsed&&s.isHeading&&(l=!0,d=s.headingLevel),t.setHidden(!1))}return a===o.widgets.length?t.numberChildNodes=a-s-1:t.numberChildNodes=a-s,e.setCellCollapse(t,n),a+1}function i(e){if(!(e instanceof ae))return{isHeading:!1,headingLevel:7};let t=e.headingInfo.level;return{isHeading:t>0,headingLevel:t,collapsed:e.headingCollapsed}}e.splitCell=function(e){if(!e.model||!e.activeCell)return;if(!ue.isNotebookRendered(e))return;const t=ue.getState(e);e.deselectAll();const n=e.model,o=e.activeCellIndex,s=e.widgets[o],i=s.editor,a=i.getSelections(),l=s.model.value.text,d=[0];let r=-1,c=-1;for(let e=0;e<a.length;e++)r=i.getOffsetAt(a[e].start),c=i.getOffsetAt(a[e].end),r<c?(d.push(r),d.push(c)):c<r?(d.push(c),d.push(r)):d.push(r);d.push(l.length);const h=[];for(let e=0;e+1<d.length;e++){const e=ue.cloneCell(n,s.model);h.push(e)}for(let e=0;e<h.length;e++)e!==h.length-1&&"code"===h[e].type&&h[e].outputs.clear(),h[e].value.text=l.slice(d[e],d[e+1]).replace(/^\n+/,"").replace(/\n+$/,"");const u=n.cells;u.beginCompoundOperation();for(let e=0;e<h.length;e++)0===e?u.set(o,h[e]):u.insert(o+e,h[e]);u.endCompoundOperation();const g=r!==c?2:1;e.activeCellIndex=o+h.length-g,e.activeCell.editor.focus(),ue.handleState(e,t)},e.mergeCells=function(e,t=!1){if(!e.model||!e.activeCell)return;if(!ue.isNotebookRendered(e))return;const n=ue.getState(e),o=[],s=[],i=e.model,a=i.cells,l=e.activeCell,d=e.activeCellIndex,r={};if(e.widgets.forEach(((t,n)=>{if(e.isSelectedOrActive(t)){o.push(t.model.value.text),n!==d&&s.push(t.model);const e=t.model;if(m(e)||p(e))for(const t of e.attachments.keys)r[t]=e.attachments.get(t).toJSON()}})),1===o.length)if(!0===t){if(0===d)return;const e=a.get(d-1);o.unshift(e.value.text),s.push(e)}else if(!1===t){if(d===a.length-1)return;const e=a.get(d+1);o.push(e.value.text),s.push(e)}e.deselectAll();const c=ue.cloneCell(i,l.model);c.value.text=o.join("\n\n"),function(e){return"code"===e.type}(c)?c.outputs.clear():(p(c)||m(c))&&c.attachments.fromJSON(r),a.beginCompoundOperation(),a.set(d,c),s.forEach((e=>{a.removeValue(e)})),a.endCompoundOperation(),l instanceof ae&&(e.activeCell.rendered=!1),ue.handleState(e,n)},e.deleteCells=function(e){if(!e.model||!e.activeCell)return;if(!ue.isNotebookRendered(e))return;const t=ue.getState(e);ue.deleteCells(e),ue.handleState(e,t,!0)},e.insertAbove=function(e){if(!e.model||!e.activeCell)return;if(!ue.isNotebookRendered(e))return;const t=ue.getState(e),n=e.model,o=n.contentFactory.createCell(e.notebookConfig.defaultCell,{}),s=e.activeCellIndex;n.cells.insert(s,o),e.activeCellIndex=s,e.deselectAll(),ue.handleState(e,t,!0)},e.insertBelow=function(e){if(!e.model||!e.activeCell)return;if(!ue.isNotebookRendered(e))return;const t=ue.getState(e),n=e.model,o=n.contentFactory.createCell(e.notebookConfig.defaultCell,{});n.cells.insert(e.activeCellIndex+1,o),e.activeCellIndex++,e.deselectAll(),ue.handleState(e,t,!0)},e.moveDown=function(e){if(!e.model||!e.activeCell)return;if(!ue.isNotebookRendered(e))return;const t=ue.getState(e),n=e.model.cells,o=e.widgets;n.beginCompoundOperation();for(let t=n.length-2;t>-1;t--)e.isSelectedOrActive(o[t])&&(e.isSelectedOrActive(o[t+1])||(n.move(t,t+1),e.activeCellIndex===t&&e.activeCellIndex++,e.select(o[t+1]),e.deselect(o[t])));n.endCompoundOperation(),ue.handleState(e,t,!0)},e.moveUp=function(e){if(!e.model||!e.activeCell)return;if(!ue.isNotebookRendered(e))return;const t=ue.getState(e),n=e.model.cells,o=e.widgets;n.beginCompoundOperation();for(let t=1;t<n.length;t++)e.isSelectedOrActive(o[t])&&(e.isSelectedOrActive(o[t-1])||(n.move(t,t-1),e.activeCellIndex===t&&e.activeCellIndex--,e.select(o[t-1]),e.deselect(o[t])));n.endCompoundOperation(),ue.handleState(e,t,!0)},e.changeCellType=function(e,t){if(!e.model||!e.activeCell)return;const n=ue.getState(e);ue.changeCellType(e,t),ue.handleState(e,n)},e.run=function(e,t){if(!e.model||!e.activeCell)return Promise.resolve(!1);const n=ue.getState(e),o=ue.runSelected(e,t);return ue.handleRunState(e,n,!1),o},e.runAndAdvance=function(e,t){if(!e.model||!e.activeCell)return Promise.resolve(!1);const n=ue.getState(e),o=ue.runSelected(e,t),s=e.model;if(e.activeCellIndex===e.widgets.length-1){const t=s.contentFactory.createCell(e.notebookConfig.defaultCell,{});s.cells.insert(e.widgets.length,t),e.activeCellIndex++,e.mode="edit"}else e.activeCellIndex++;return ue.handleRunState(e,n,!0),o},e.runAndInsert=function(e,t){if(!e.model||!e.activeCell)return Promise.resolve(!1);if(!ue.isNotebookRendered(e))return Promise.resolve(!1);const n=ue.getState(e),o=ue.runSelected(e,t),s=e.model,i=s.contentFactory.createCell(e.notebookConfig.defaultCell,{});return s.cells.insert(e.activeCellIndex+1,i),e.activeCellIndex++,e.mode="edit",ue.handleRunState(e,n,!0),o},e.runAll=function(e,t){if(!e.model||!e.activeCell)return Promise.resolve(!1);const n=ue.getState(e);e.widgets.forEach((t=>{e.select(t)}));const o=ue.runSelected(e,t);return ue.handleRunState(e,n,!0),o},e.renderAllMarkdown=function(e,t){if(!e.model||!e.activeCell)return Promise.resolve(!1);const n=e.activeCellIndex,o=ue.getState(e);if(e.widgets.forEach(((t,n)=>{"markdown"===t.model.type&&(e.select(t),e.activeCellIndex=n)})),"markdown"!==e.activeCell.model.type)return Promise.resolve(!0);const s=ue.runSelected(e,t);return e.activeCellIndex=n,ue.handleRunState(e,o,!0),s},e.runAllAbove=function(e,t){const{activeCell:n,activeCellIndex:o,model:s}=e;if(!s||!n||o<1)return Promise.resolve(!1);const i=ue.getState(e);e.activeCellIndex--,e.deselectAll();for(let t=0;t<e.activeCellIndex;++t)e.select(e.widgets[t]);const a=ue.runSelected(e,t);return e.activeCellIndex++,ue.handleRunState(e,i,!0),a},e.runAllBelow=function(e,t){if(!e.model||!e.activeCell)return Promise.resolve(!1);const n=ue.getState(e);e.deselectAll();for(let t=e.activeCellIndex;t<e.widgets.length;++t)e.select(e.widgets[t]);const o=ue.runSelected(e,t);return ue.handleRunState(e,n,!0),o},e.replaceSelection=function(e,t){var n,o;e.model&&e.activeCell&&(null===(o=(n=e.activeCell.editor).replaceSelection)||void 0===o||o.call(n,t))},e.selectAbove=function(e){if(!e.model||!e.activeCell)return;if(0===e.activeCellIndex)return;let t=e.activeCellIndex-1;for(;t>=0;){const n=e.widgets[t];if(!n.inputHidden&&!n.isHidden)break;t-=1}const n=ue.getState(e);e.activeCellIndex=t,e.deselectAll(),ue.handleState(e,n,!0)},e.selectBelow=function(e){if(!e.model||!e.activeCell)return;let t=e.widgets.length-1;for(;e.widgets[t].isHidden||e.widgets[t].inputHidden;)t-=1;if(e.activeCellIndex===t)return;let n=e.activeCellIndex+1;for(;n<t;){let t=e.widgets[n];if(!t.inputHidden&&!t.isHidden)break;n+=1}const o=ue.getState(e);e.activeCellIndex=n,e.deselectAll(),ue.handleState(e,o,!0)},e.extendSelectionAbove=function(e,t=!1){if(!e.model||!e.activeCell)return;if(0===e.activeCellIndex)return;const n=ue.getState(e);e.mode="command",t?e.extendContiguousSelectionTo(0):e.extendContiguousSelectionTo(e.activeCellIndex-1),ue.handleState(e,n,!0)},e.extendSelectionBelow=function(e,t=!1){if(!e.model||!e.activeCell)return;if(e.activeCellIndex===e.widgets.length-1)return;const n=ue.getState(e);e.mode="command",t?e.extendContiguousSelectionTo(e.widgets.length-1):e.extendContiguousSelectionTo(e.activeCellIndex+1),ue.handleState(e,n,!0)},e.selectAll=function(e){e.model&&e.activeCell&&e.widgets.forEach((t=>{e.select(t)}))},e.deselectAll=function(e){e.model&&e.activeCell&&e.deselectAll()},e.copy=function(e){ue.copyOrCut(e,!1)},e.cut=function(e){ue.isNotebookRendered(e)&&ue.copyOrCut(e,!0)},e.paste=function(e,n="below"){if(!ue.isNotebookRendered(e))return;const s=o.Clipboard.getInstance();s.hasData(re)&&t(e,n,s.getData(re),!0)},e.duplicate=function(e,n="below"){const o=ue.selectedCells(e);o&&0!==o.length&&t(e,n,o,!1)},e.undo=function(e){if(!e.model||!e.activeCell)return;if(!ue.isNotebookRendered(e))return;const t=ue.getState(e);e.mode="command",e.model.sharedModel.undo(),e.deselectAll(),ue.handleState(e,t)},e.redo=function(e){if(!e.model||!e.activeCell)return;const t=ue.getState(e);e.mode="command",e.model.sharedModel.redo(),e.deselectAll(),ue.handleState(e,t)},e.toggleAllLineNumbers=function(e){if(!e.model||!e.activeCell)return;const t=ue.getState(e),n=e.editorConfig,o=!(n.code.lineNumbers&&n.markdown.lineNumbers&&n.raw.lineNumbers),s={code:Object.assign(Object.assign({},n.code),{lineNumbers:o}),markdown:Object.assign(Object.assign({},n.markdown),{lineNumbers:o}),raw:Object.assign(Object.assign({},n.raw),{lineNumbers:o})};e.editorConfig=s,ue.handleState(e,t)},e.clearOutputs=function(e){if(!e.model||!e.activeCell)return;const t=ue.getState(e);(0,x.each)(e.model.cells,((t,n)=>{const o=e.widgets[n];e.isSelectedOrActive(o)&&"code"===t.type&&(t.clearExecution(),o.outputHidden=!1)})),ue.handleState(e,t,!0)},e.clearAllOutputs=function(e){if(!e.model||!e.activeCell)return;const t=ue.getState(e);(0,x.each)(e.model.cells,((t,n)=>{const o=e.widgets[n];"code"===t.type&&(t.clearExecution(),o.outputHidden=!1)})),ue.handleState(e,t,!0)},e.hideCode=function(e){if(!e.model||!e.activeCell)return;const t=ue.getState(e);e.widgets.forEach((t=>{e.isSelectedOrActive(t)&&"code"===t.model.type&&(t.inputHidden=!0)})),ue.handleState(e,t)},e.showCode=function(e){if(!e.model||!e.activeCell)return;const t=ue.getState(e);e.widgets.forEach((t=>{e.isSelectedOrActive(t)&&"code"===t.model.type&&(t.inputHidden=!1)})),ue.handleState(e,t)},e.hideAllCode=function(e){if(!e.model||!e.activeCell)return;const t=ue.getState(e);e.widgets.forEach((e=>{"code"===e.model.type&&(e.inputHidden=!0)})),ue.handleState(e,t)},e.showAllCode=function(e){if(!e.model||!e.activeCell)return;const t=ue.getState(e);e.widgets.forEach((e=>{"code"===e.model.type&&(e.inputHidden=!1)})),ue.handleState(e,t)},e.hideOutput=function(e){if(!e.model||!e.activeCell)return;const t=ue.getState(e);e.widgets.forEach((t=>{e.isSelectedOrActive(t)&&"code"===t.model.type&&(t.outputHidden=!0)})),ue.handleState(e,t,!0)},e.showOutput=function(e){if(!e.model||!e.activeCell)return;const t=ue.getState(e);e.widgets.forEach((t=>{e.isSelectedOrActive(t)&&"code"===t.model.type&&(t.outputHidden=!1)})),ue.handleState(e,t)},e.hideAllOutputs=function(e){if(!e.model||!e.activeCell)return;const t=ue.getState(e);e.widgets.forEach((e=>{"code"===e.model.type&&(e.outputHidden=!0)})),ue.handleState(e,t,!0)},e.renderSideBySide=function(e){e.renderingLayout="side-by-side"},e.renderDefault=function(e){e.renderingLayout="default"},e.showAllOutputs=function(e){if(!e.model||!e.activeCell)return;const t=ue.getState(e);e.widgets.forEach((e=>{"code"===e.model.type&&(e.outputHidden=!1)})),ue.handleState(e,t)},e.enableOutputScrolling=function(e){if(!e.model||!e.activeCell)return;const t=ue.getState(e);e.widgets.forEach((t=>{e.isSelectedOrActive(t)&&"code"===t.model.type&&(t.outputsScrolled=!0)})),ue.handleState(e,t,!0)},e.disableOutputScrolling=function(e){if(!e.model||!e.activeCell)return;const t=ue.getState(e);e.widgets.forEach((t=>{e.isSelectedOrActive(t)&&"code"===t.model.type&&(t.outputsScrolled=!1)})),ue.handleState(e,t)},e.selectLastRunCell=function(e){let t=null,n=null;e.widgets.forEach(((e,o)=>{if("code"===e.model.type){const i=e.model.metadata.get("execution");if(i&&s.JSONExt.isObject(i)&&void 0!==i["iopub.status.busy"]){const e=i["iopub.status.busy"].toString();if(e){const s=new Date(e);(!t||s>=t)&&(t=s,n=o)}}}})),null!==n&&(e.activeCellIndex=n)},e.setMarkdownHeader=function(e,t){if(!e.model||!e.activeCell)return;const n=ue.getState(e),o=e.model.cells;t=Math.min(Math.max(t,1),6),e.widgets.forEach(((n,s)=>{e.isSelectedOrActive(n)&&ue.setMarkdownHeader(o.get(s),t)})),ue.changeCellType(e,"markdown"),ue.handleState(e,n)},e.collapseAll=function(t){for(const n of t.widgets)e.getHeadingInfo(n).isHeading&&(e.setHeadingCollapse(n,!0,t),e.setCellCollapse(n,!0))},e.expandAllHeadings=function(t){for(const n of t.widgets)e.getHeadingInfo(n).isHeading&&(e.setHeadingCollapse(n,!1,t),e.setCellCollapse(n,!1))},e.expandParent=function e(t,o){let s=function(e,t){const n=(0,x.findIndex)(t.widgets,((t,n)=>e.model.id===t.model.id));if(-1===n)return;if(n>=t.widgets.length)return;let o=i(t.widgets[n]);for(let e=n-1;e>=0;e--)if(e<t.widgets.length){let n=i(t.widgets[e]);if(n.isHeading&&n.headingLevel<o.headingLevel)return t.widgets[e]}}(t,o);s&&(i(s).collapsed||s.isHidden)&&(s.isHidden&&e(s,o),i(s).collapsed&&n(s,!1,o))},e.findNextParentHeading=function(e,t){let n=(0,x.findIndex)(t.widgets,((t,n)=>e.model.id===t.model.id));if(-1===n)return-1;let o=i(e);for(n+=1;n<t.widgets.length;n++){let e=i(t.widgets[n]);if(e.isHeading&&e.headingLevel<=o.headingLevel)return n}return t.widgets.length},e.setHeadingCollapse=n,e.toggleCurrentHeadingCollapse=function(t){if(!t.activeCell||void 0===t.activeCellIndex)return;let n=e.getHeadingInfo(t.activeCell);n.isHeading&&e.setHeadingCollapse(t.activeCell,!n.collapsed,t),M.ElementExt.scrollIntoViewIfNeeded(t.node,t.activeCell.node)},e.setCellCollapse=function(e,t){e instanceof ae?e.headingCollapsed=t:e.setHidden(t)},e.getHeadingInfo=i,e.trust=function(e,t){const n=(t=t||de.nullTranslator).load("jupyterlab");if(!e.model)return Promise.resolve();const s=(0,x.toArray)(e.model.cells),i=s.every((e=>e.trusted)),a=D.createElement("p",null,n.__("A trusted Jupyter notebook may execute hidden malicious code when you open it."),D.createElement("br",null),n.__("Selecting trust will re-render this notebook in a trusted state."),D.createElement("br",null),n.__("For more information, see")," ",D.createElement("a",{href:"https://jupyter-server.readthedocs.io/en/stable/operators/security.html",target:"_blank",rel:"noopener noreferrer"},n.__("the Jupyter security documentation")));return i?(0,o.showDialog)({body:n.__("Notebook is already trusted"),buttons:[o.Dialog.okButton({label:n.__("Ok")})]}).then((()=>{})):(0,o.showDialog)({body:a,title:n.__("Trust this notebook?"),buttons:[o.Dialog.cancelButton({label:n.__("Cancel")}),o.Dialog.warnButton({label:n.__("Ok")})]}).then((e=>{e.button.accept&&s.forEach((e=>{e.trusted=!0}))}))}}(he||(he={})),function(e){function t(e){return{wasFocused:e.node.contains(document.activeElement),activeCell:e.activeCell}}function n(e,t,n=!1){const{activeCell:o,node:s}=e;(t.wasFocused||"edit"===e.mode)&&e.activate(),n&&o&&M.ElementExt.scrollIntoViewIfNeeded(s,o.node)}function s(e){const t=e.model,n=t.cells,o=[];e.mode="command",e.widgets.forEach(((n,s)=>{const i=!1!==n.model.metadata.get("deletable");e.isSelectedOrActive(n)&&i&&(o.push(s),t.deletedCells.push(n.model.id))})),o.length>0&&(n.beginCompoundOperation(),o.reverse().forEach((e=>{n.remove(e)})),n.length||n.push(t.contentFactory.createCell(e.notebookConfig.defaultCell,{})),n.endCompoundOperation(),e.activeCellIndex=o[0]-o.length+1),e.deselectAll()}e.executed=new i.Signal({}),e.executionScheduled=new i.Signal({}),e.selectionExecuted=new i.Signal({}),e.isNotebookRendered=function(e){const t=e.translator.load("jupyterlab");return 0===e.remainingCellToRenderCount||((0,o.showDialog)({body:t.__("Notebook is still rendering and has for now (%1) remaining cells to render.\n\nPlease wait for the complete rendering before invoking that action.",e.remainingCellToRenderCount),buttons:[o.Dialog.okButton({label:t.__("Ok")})]}).catch((e=>{console.error("An error occurred when displaying notebook rendering warning",e)})),!1)},e.getState=t,e.handleState=n,e.handleRunState=function(e,t,n=!1){if((t.wasFocused||"edit"===e.mode)&&e.activate(),n&&t.activeCell){const n=t.activeCell.inputArea.node.getBoundingClientRect();e.scrollToPosition(n.bottom,45)}},e.cloneCell=function(e,t){switch(t.type){case"code":return e.contentFactory.createCodeCell({cell:t.toJSON()});case"markdown":return e.contentFactory.createMarkdownCell({cell:t.toJSON()});default:return e.contentFactory.createRawCell({cell:t.toJSON()})}},e.runSelected=function(t,n){t.mode="command";let s=t.activeCellIndex;const i=t.widgets.filter(((e,n)=>{const o=t.isSelectedOrActive(e);return o&&(s=n),o}));return t.activeCellIndex=s,t.deselectAll(),Promise.all(i.map((s=>function(t,n,s,i){var a,l,d;const r=(i=i||de.nullTranslator).load("jupyterlab");switch(n.model.type){case"markdown":n.rendered=!0,n.inputHidden=!1,e.executed.emit({notebook:t,cell:n,success:!0});break;case"code":if(s){if(s.isTerminating){(0,o.showDialog)({title:r.__("Kernel Terminating"),body:r.__("The kernel for %1 appears to be terminating. You can not run any cell for now.",null===(a=s.session)||void 0===a?void 0:a.path),buttons:[o.Dialog.okButton({label:r.__("Ok")})]});break}if(s.pendingInput)return(0,o.showDialog)({title:r.__("Cell not executed due to pending input"),body:r.__("The cell has not been executed to avoid kernel deadlock as there is another pending input! Submit your pending input and try again."),buttons:[o.Dialog.okButton({label:r.__("Ok")})]}),Promise.resolve(!1);if(s.hasNoKernel)return o.sessionContextDialogs.selectKernel(s),Promise.resolve(!1);const i=null!==(d=null===(l=t.model)||void 0===l?void 0:l.deletedCells)&&void 0!==d?d:[];return e.executionScheduled.emit({notebook:t,cell:n}),se.execute(n,s,{deletedCells:i,recordTiming:t.notebookConfig.recordTiming}).then((e=>{if(i.splice(0,i.length),n.isDisposed)return!1;if(!e)return!0;if("ok"===e.content.status){const o=e.content;return o.payload&&o.payload.length&&function(e,t,n){var o;const s=null===(o=e.payload)||void 0===o?void 0:o.filter((e=>"set_next_input"===e.source))[0];if(!s)return;const i=s.text;if(s.replace)return void(n.model.value.text=i);const a=t.model.contentFactory.createCodeCell({}),l=t.model.cells,d=x.ArrayExt.firstIndexOf((0,x.toArray)(l),n.model);a.value.text=i,-1===d?l.push(a):l.insert(d+1,a)}(o,t,n),!0}throw new ce(e.content)})).catch((o=>{if(n.isDisposed||o.message.startsWith("Canceled"))return!1;throw e.executed.emit({notebook:t,cell:n,success:!1,error:o}),o})).then((o=>(o&&e.executed.emit({notebook:t,cell:n,success:!0}),o)))}n.model.clearExecution()}return Promise.resolve(!0)}(t,s,n)))).then((n=>!t.isDisposed&&(e.selectionExecuted.emit({notebook:t,lastCell:t.widgets[s]}),t.update(),n.every((e=>e))))).catch((n=>{if(!n.message.startsWith("KernelReplyNotOK"))throw n;return i.map((e=>{"code"===e.model.type&&null==e.model.executionCount&&e.setPrompt("")})),e.selectionExecuted.emit({notebook:t,lastCell:t.widgets[s]}),t.update(),!1}))},e.selectedCells=function(e){return e.widgets.filter((t=>e.isSelectedOrActive(t))).map((e=>e.model.toJSON())).map((e=>(void 0!==e.metadata.deletable&&delete e.metadata.deletable,e)))},e.copyOrCut=function(i,a){if(!i.model||!i.activeCell)return;const l=t(i),d=o.Clipboard.getInstance();i.mode="command",d.clear();const r=e.selectedCells(i);d.setData(re,r),a?s(i):i.deselectAll(),i.lastClipboardInteraction=a?"cut":"copy",n(i,l)},e.changeCellType=function(e,t){const n=e.model,o=n.cells;o.beginCompoundOperation(),e.widgets.forEach(((s,i)=>{if(e.isSelectedOrActive(s)){if(s.model.type!==t){const e=s.model.toJSON();let a;switch(t){case"code":a=n.contentFactory.createCodeCell({cell:e});break;case"markdown":a=n.contentFactory.createMarkdownCell({cell:e}),"code"===s.model.type&&(a.trusted=!1);break;default:a=n.contentFactory.createRawCell({cell:e}),"code"===s.model.type&&(a.trusted=!1)}o.set(i,a)}"markdown"===t&&((s=e.widgets[i]).rendered=!1)}})),o.endCompoundOperation(),e.deselectAll()},e.deleteCells=s,e.setMarkdownHeader=function(e,t){let n=e.value.text;const o=Array(t+1).join("#")+" ",s=/^(#+\s*)|^(\s*)/.exec(n);s&&(n=n.slice(s[0].length)),e.value.text=o+n}}(ue||(ue={})),function(e){function t(e,t){const n=(t||de.nullTranslator).load("jupyterlab");function s(){if(e.context.model.readOnly)return(0,o.showDialog)({title:n.__("Cannot Save"),body:n.__("Document is read-only"),buttons:[o.Dialog.okButton({label:n.__("Ok")})]});e.context.save().then((()=>{if(!e.isDisposed)return e.context.createCheckpoint()}))}return(0,o.addToolbarButtonClass)(o.ReactWidget.create(D.createElement(o.UseSignal,{signal:e.context.fileChanged},(()=>D.createElement(o.ToolbarButtonComponent,{icon:S.saveIcon,onClick:s,tooltip:n.__("Save the notebook contents and create checkpoint"),enabled:!!(e&&e.context&&e.context.contentsModel&&e.context.contentsModel.writable)})))))}function n(e,t){const n=(t||de.nullTranslator).load("jupyterlab");return new o.ToolbarButton({icon:S.addIcon,onClick:()=>{he.insertBelow(e.content)},tooltip:n.__("Insert a cell below")})}function s(e,t){const n=(t||de.nullTranslator).load("jupyterlab");return new o.ToolbarButton({icon:S.cutIcon,onClick:()=>{he.cut(e.content)},tooltip:n.__("Cut the selected cells")})}function i(e,t){const n=(t||de.nullTranslator).load("jupyterlab");return new o.ToolbarButton({icon:S.copyIcon,onClick:()=>{he.copy(e.content)},tooltip:n.__("Copy the selected cells")})}function a(e,t){const n=(t||de.nullTranslator).load("jupyterlab");return new o.ToolbarButton({icon:S.pasteIcon,onClick:()=>{he.paste(e.content)},tooltip:n.__("Paste cells from the clipboard")})}function l(e,t){const n=(t||de.nullTranslator).load("jupyterlab");return new o.ToolbarButton({icon:S.runIcon,onClick:()=>{he.runAndAdvance(e.content,e.sessionContext)},tooltip:n.__("Run the selected cells and advance")})}function d(e,t,n){const s=(n||de.nullTranslator).load("jupyterlab");return new o.ToolbarButton({icon:S.fastForwardIcon,onClick:()=>{(null!=t?t:o.sessionContextDialogs).restart(e.sessionContext,n).then((t=>(t&&he.runAll(e.content,e.sessionContext),t)))},tooltip:s.__("Restart the kernel, then re-run the whole notebook")})}function r(e,t){return new pe(e.content,t)}e.createSaveButton=t,e.createInsertButton=n,e.createCutButton=s,e.createCopyButton=i,e.createPasteButton=a,e.createRunButton=l,e.createRestartRunAllButton=d,e.createCellTypeItem=r,e.getDefaultItems=function(e,c,h){return[{name:"save",widget:t(e,h)},{name:"insert",widget:n(e,h)},{name:"cut",widget:s(e,h)},{name:"copy",widget:i(e,h)},{name:"paste",widget:a(e,h)},{name:"run",widget:l(e,h)},{name:"interrupt",widget:o.Toolbar.createInterruptButton(e.sessionContext,h)},{name:"restart",widget:o.Toolbar.createRestartButton(e.sessionContext,c,h)},{name:"restart-and-run",widget:d(e,c,h)},{name:"cellType",widget:r(e,h)},{name:"spacer",widget:o.Toolbar.createSpacerItem()},{name:"kernelName",widget:o.Toolbar.createKernelNameItem(e.sessionContext,c,h)}]}}(ge||(ge={}));class pe extends o.ReactWidget{constructor(e,t){super(),this.handleChange=e=>{"-"!==e.target.value&&(he.changeCellType(this._notebook,e.target.value),this._notebook.activate())},this.handleKeyDown=e=>{13===e.keyCode&&this._notebook.activate()},this._trans=(t||de.nullTranslator).load("jupyterlab"),this.addClass("jp-Notebook-toolbarCellType"),this._notebook=e,e.model&&this.update(),e.activeCellChanged.connect(this.update,this),e.selectionChanged.connect(this.update,this)}render(){let e="-";this._notebook.activeCell&&(e=this._notebook.activeCell.model.type);for(const t of this._notebook.widgets)if(this._notebook.isSelectedOrActive(t)&&t.model.type!==e){e="-";break}return D.createElement(S.HTMLSelect,{className:"jp-Notebook-toolbarCellTypeDropdown",onChange:this.handleChange,onKeyDown:this.handleKeyDown,value:e,"aria-label":this._trans.__("Cell type"),title:this._trans.__("Select the cell type")},D.createElement("option",{value:"-"},"-"),D.createElement("option",{value:"code"},this._trans.__("Code")),D.createElement("option",{value:"markdown"},this._trans.__("Markdown")),D.createElement("option",{value:"raw"},this._trans.__("Raw")))}}var me=n(49939),Ce=n(13491),_e=n(60009);class ve{constructor(e,t,n){this._mutex=h.M(),this._isDisposed=!1,this._changed=new i.Signal(this),this._factory=t,this._cellOrder=e.createList("cellOrder"),this._cellMap=new a.v,this._cellOrder.changed.connect(this._onOrderChanged,this),this.nbmodel=n,this.nbmodel.changed.connect(this.onSharedModelChanged,this),this.changed.connect(this.onModelDBChanged,this)}onModelDBChanged(e,t){this._mutex((()=>{const e=this.nbmodel;e.transact((()=>{if("set"!==t.type&&"remove"!==t.type||e.deleteCellRange(t.oldIndex,t.oldIndex+t.oldValues.length),"set"===t.type||"add"===t.type||"move"===t.type){const n=t.newValues.map((e=>e.sharedModel.clone()));let o=t.newIndex;"move"===t.type&&o>t.oldIndex&&(o+=t.oldValues.length),e.insertCells(o,n),t.newValues.forEach(((e,t)=>{e.switchSharedModel(n[t],!1)}))}if("move"===t.type){let n=t.oldIndex;n>=t.newIndex&&(n+=t.oldValues.length),e.deleteCellRange(n,n+t.oldValues.length)}}))}))}onSharedModelChanged(e,t){this._mutex((()=>{var e;let n=0;null===(e=t.cellsChange)||void 0===e||e.forEach((e=>{if(null!=e.insert){const t=e.insert.map((e=>{const t=this._factory.createCell(e.cell_type,{});return t.switchSharedModel(e,!0),t}));this.insertAll(n,t),n+=e.insert.length}else null!=e.delete?this.removeRange(n,n+e.delete):null!=e.retain&&(n+=e.retain)}))}))}get changed(){return this._changed}get isDisposed(){return this._isDisposed}get isEmpty(){return 0===this._cellOrder.length}get length(){return this._cellOrder.length}iter(){const e=[];for(const t of(0,x.toArray)(this._cellOrder))e.push(this._cellMap.get(t));return new x.ArrayIterator(e)}dispose(){if(!this._isDisposed){this._isDisposed=!0,i.Signal.clearData(this);for(const e of this._cellMap.values())e.dispose();this._cellMap.dispose(),this._cellOrder.dispose()}}get(e){return this._cellMap.get(this._cellOrder.get(e))}set(e,t){this._cellMap.set(t.id,t),this._cellOrder.set(e,t.id)}push(e){return this._cellMap.set(e.id,e),this._cellOrder.push(e.id)}insert(e,t){this._cellMap.set(t.id,t),this._cellOrder.insert(e,t.id)}removeValue(e){const t=x.ArrayExt.findFirstIndex((0,x.toArray)(this._cellOrder),(t=>this._cellMap.get(t)===e));return this.remove(t),t}remove(e){const t=this._cellOrder.get(e);return this._cellOrder.remove(e),this._cellMap.get(t)}clear(){this._cellOrder.clear()}move(e,t){this._cellOrder.move(e,t)}pushAll(e){const t=(0,x.toArray)(e);return(0,x.each)(t,(e=>{this._cellMap.set(e.id,e),this._cellOrder.push(e.id)})),this.length}insertAll(e,t){const n=(0,x.toArray)(t);return(0,x.each)(n,(t=>{this._cellMap.set(t.id,t),this._cellOrder.beginCompoundOperation(),this._cellOrder.insert(e++,t.id),this._cellOrder.endCompoundOperation()})),this.length}removeRange(e,t){return this._cellOrder.removeRange(e,t),this.length}get canRedo(){return this.nbmodel.canRedo()}get canUndo(){return this.nbmodel.canUndo()}beginCompoundOperation(e){this._cellOrder.beginCompoundOperation(e)}endCompoundOperation(){this._cellOrder.endCompoundOperation()}undo(){this.nbmodel.undo()}redo(){this.nbmodel.redo()}clearUndo(){this.nbmodel.clearUndoHistory()}_onOrderChanged(e,t){"add"!==t.type&&"set"!==t.type||(0,x.each)(t.newValues,(e=>{const t=this._cellMap.get(e);if(null==t){let t;switch(this._factory.modelDB.createValue(e+".type").get()){case"code":t=this._factory.createCodeCell({id:e});break;case"markdown":t=this._factory.createMarkdownCell({id:e});break;default:t=this._factory.createRawCell({id:e})}this._cellMap.set(e,t)}else t.sharedModel.isStandalone||this._mutex((()=>{const n=t.toJSON();let o=null;switch(n.cell_type){case"code":o=this._factory.createCodeCell({cell:n});break;case"markdown":o=this._factory.createMarkdownCell({cell:n});break;default:o=this._factory.createRawCell({cell:n})}this._cellMap.set(e,o)}))}));const n=[],o=[];(0,x.each)(t.newValues,(e=>{n.push(this._cellMap.get(e))})),(0,x.each)(t.oldValues,(e=>{o.push(this._cellMap.get(e))})),this._changed.emit({type:t.type,oldIndex:t.oldIndex,newIndex:t.newIndex,oldValues:o,newValues:n})}}const fe=["kernelspec","language_info"];class ye{constructor(e={}){this._modelDBMutex=h.M(),this._readOnly=!1,this._contentChanged=new i.Signal(this),this._stateChanged=new i.Signal(this),this._nbformat=me.MAJOR_VERSION,this._nbformatMinor=me.MINOR_VERSION,this._isDisposed=!1,e.modelDB?this.modelDB=e.modelDB:this.modelDB=new Ce.D,this.sharedModel=_e.hN.create(e.disableDocumentWideUndoRedo||!1),this._isInitialized=!1!==e.isInitialized;const t=e.contentFactory||ye.defaultContentFactory;this.contentFactory=t.clone(this.modelDB.view("cells")),this._cells=new ve(this.modelDB,this.contentFactory,this.sharedModel),this._trans=(e.translator||de.nullTranslator).load("jupyterlab"),this._cells.changed.connect(this._onCellsChanged,this);const n=this.modelDB.createMap("metadata");if(!n.has("language_info")){const t=e.languagePreference||"";n.set("language_info",{name:t})}this._ensureMetadata(),n.changed.connect(this._onMetadataChanged,this),this._deletedCells=[],this.sharedModel.dirty=!1,this.sharedModel.changed.connect(this._onStateChanged,this)}get contentChanged(){return this._contentChanged}get stateChanged(){return this._stateChanged}get dirty(){return this.sharedModel.dirty}set dirty(e){e!==this.dirty&&(this.sharedModel.dirty=e)}get readOnly(){return this._readOnly}set readOnly(e){if(e===this._readOnly)return;const t=this._readOnly;this._readOnly=e,this.triggerStateChange({name:"readOnly",oldValue:t,newValue:e})}get metadata(){return this.modelDB.get("metadata")}get cells(){return this._cells}get nbformat(){return this._nbformat}get nbformatMinor(){return this._nbformatMinor}get defaultKernelName(){const e=this.metadata.get("kernelspec");return e?e.name:""}get deletedCells(){return this._deletedCells}get isInitialized(){return this._isInitialized}get defaultKernelLanguage(){const e=this.metadata.get("language_info");return e?e.name:""}dispose(){if(this.isDisposed)return;const e=this.cells;this._cells=null,e.dispose(),this._isDisposed=!0,this.modelDB.dispose(),i.Signal.clearData(this)}toString(){return JSON.stringify(this.toJSON())}fromString(e){this.fromJSON(JSON.parse(e))}toJSON(){var e,t;const n=[];for(let o=0;o<(null!==(t=null===(e=this.cells)||void 0===e?void 0:e.length)&&void 0!==t?t:0);o++){const e=this.cells.get(o).toJSON();4===this._nbformat&&this._nbformatMinor<=4&&delete e.id,n.push(e)}this._ensureMetadata();const o=this.sharedModel.getMetadata();for(const e of this.metadata.keys())o[e]=JSON.parse(JSON.stringify(this.metadata.get(e)));return{metadata:o,nbformat_minor:this._nbformatMinor,nbformat:this._nbformat,cells:n}}fromJSON(e){const t=[],n=this.contentFactory,s=4===e.nbformat&&e.nbformat_minor>=5;for(const o of e.cells){const e={cell:o};switch(s&&(e.id=o.id),o.cell_type){case"code":t.push(n.createCodeCell(e));break;case"markdown":t.push(n.createMarkdownCell(e));break;case"raw":t.push(n.createRawCell(e));break;default:continue}}this.cells.beginCompoundOperation(),this.cells.clear(),this.cells.pushAll(t),this.cells.endCompoundOperation(),this.sharedModel.nbformat_minor=me.MINOR_VERSION,this.sharedModel.nbformat=me.MAJOR_VERSION;const i=e.metadata.orig_nbformat;if(e.nbformat!==this._nbformat&&(this.sharedModel.nbformat=e.nbformat),e.nbformat_minor>this._nbformatMinor&&(this.sharedModel.nbformat_minor=e.nbformat_minor),void 0!==i&&this._nbformat!==i){let e;e=this._nbformat>i?this._trans.__("This notebook has been converted from an older notebook format (v%1)\nto the current notebook format (v%2).\nThe next time you save this notebook, the current notebook format (v%2) will be used.\n'Older versions of Jupyter may not be able to read the new format.' To preserve the original format version,\nclose the notebook without saving it.",i,this._nbformat):this._trans.__("This notebook has been converted from an newer notebook format (v%1)\nto the current notebook format (v%2).\nThe next time you save this notebook, the current notebook format (v%2) will be used.\nSome features of the original notebook may not be available.' To preserve the original format version,\nclose the notebook without saving it.",i,this._nbformat),(0,o.showDialog)({title:this._trans.__("Notebook converted"),body:e,buttons:[o.Dialog.okButton({label:this._trans.__("Ok")})]})}this.metadata.clear();const a=e.metadata;for(const e in a)"orig_nbformat"!==e&&this.metadata.set(e,a[e]);this._ensureMetadata(),this.dirty=!0}initialize(){if(!this.cells.length){const e=this.contentFactory;this.cells.push(e.createCodeCell({}))}this._isInitialized=!0,this.cells.clearUndo()}_onCellsChanged(e,t){switch(t.type){case"add":case"set":t.newValues.forEach((e=>{e.contentChanged.connect(this.triggerContentChange,this)}))}this.triggerContentChange()}_onStateChanged(e,t){if(t.stateChange&&t.stateChange.forEach((e=>{"nbformat"===e.name&&(this._nbformat=e.newValue),"nbformatMinor"===e.name&&(this._nbformatMinor=e.newValue),"dirty"===e.name&&e.oldValue===e.newValue||this.triggerStateChange(e)})),t.metadataChange){const e=t.metadataChange.newValue;this._modelDBMutex((()=>{Object.entries(e).forEach((([e,t])=>{this.metadata.set(e,t)}))}))}}_onMetadataChanged(e,t){fe.includes(t.key)||this._modelDBMutex((()=>{this.sharedModel.updateMetadata(e.toJSON())})),this.triggerContentChange()}_ensureMetadata(){const e=this.metadata;e.has("language_info")||e.set("language_info",{name:""}),e.has("kernelspec")||e.set("kernelspec",{name:"",display_name:""})}triggerStateChange(e){this._stateChanged.emit(e)}triggerContentChange(){this._contentChanged.emit(void 0),this.dirty=!0}get isDisposed(){return this._isDisposed}}!function(e){class t{constructor(e){this.codeCellContentFactory=e.codeCellContentFactory||y.defaultContentFactory,this.modelDB=e.modelDB}createCell(e,t){switch(e){case"code":return this.createCodeCell(t);case"markdown":return this.createMarkdownCell(t);default:return this.createRawCell(t)}}createCodeCell(e){return e.contentFactory&&(e.contentFactory=this.codeCellContentFactory),this.modelDB&&(e.id||(e.id=s.UUID.uuid4()),e.modelDB=this.modelDB.view(e.id)),new y(e)}createMarkdownCell(e){return this.modelDB&&(e.id||(e.id=s.UUID.uuid4()),e.modelDB=this.modelDB.view(e.id)),new f(e)}createRawCell(e){return this.modelDB&&(e.id||(e.id=s.UUID.uuid4()),e.modelDB=this.modelDB.view(e.id)),new v(e)}clone(e){return new t({modelDB:e,codeCellContentFactory:this.codeCellContentFactory})}}e.ContentFactory=t,e.defaultContentFactory=new t({})}(ye||(ye={}));class be{constructor(e){this._disposed=!1,this._disableDocumentWideUndoRedo=e.disableDocumentWideUndoRedo||!1;const t=e.codeCellContentFactory;this.contentFactory=e.contentFactory||new ye.ContentFactory({codeCellContentFactory:t})}set disableDocumentWideUndoRedo(e){this._disableDocumentWideUndoRedo=e}get name(){return"notebook"}get contentType(){return"notebook"}get fileFormat(){return"json"}get isDisposed(){return this._disposed}dispose(){this._disposed=!0}createNew(e,t,n){const o=this.contentFactory;return new ye({languagePreference:e,contentFactory:o,modelDB:t,isInitialized:n,disableDocumentWideUndoRedo:this._disableDocumentWideUndoRedo})}preferredLanguage(e){return""}}var we=n(84939);function ke(e){const t=(e.translator||de.nullTranslator).load("jupyterlab");return D.createElement(we.Jy,{source:t.__("Mode: %1",e.modeNames[e.notebookMode])})}class Se extends o.VDomRenderer{constructor(e){super(new Se.Model),this.translator=e||de.nullTranslator,this._trans=this.translator.load("jupyterlab"),this._modeNames={command:this._trans.__("Command"),edit:this._trans.__("Edit")}}render(){return this.model?(this.node.title=this._trans.__("Notebook is in %1 mode",this._modeNames[this.model.notebookMode]),D.createElement(ke,{notebookMode:this.model.notebookMode,translator:this.translator,modeNames:this._modeNames})):null}}!function(e){class t extends o.VDomModel{constructor(){super(...arguments),this._onChanged=e=>{const t=this._notebookMode;this._notebook?this._notebookMode=e.mode:this._notebookMode="command",this._triggerChange(t,this._notebookMode)},this._notebookMode="command",this._notebook=null}get notebookMode(){return this._notebookMode}set notebook(e){const t=this._notebook;null!==t&&(t.stateChanged.disconnect(this._onChanged,this),t.activeCellChanged.disconnect(this._onChanged,this),t.modelContentChanged.disconnect(this._onChanged,this));const n=this._notebookMode;this._notebook=e,null===this._notebook?this._notebookMode="command":(this._notebookMode=this._notebook.mode,this._notebook.stateChanged.connect(this._onChanged,this),this._notebook.activeCellChanged.connect(this._onChanged,this),this._notebook.modelContentChanged.connect(this._onChanged,this)),this._triggerChange(n,this._notebookMode)}_triggerChange(e,t){e!==t&&this.stateChanged.emit(void 0)}}e.Model=t}(Se||(Se={}));const xe="jp-mod-error";class Oe extends E.Widget{constructor(e){super(),this._dataDirty=!1,this._inputDirty=!1,this._source=null,this._originalValue=s.JSONExt.emptyObject,this._changeGuard=!1,this.translator=e.translator||de.nullTranslator,this._trans=this.translator.load("jupyterlab"),this.addClass("jp-JSONEditor"),this.headerNode=document.createElement("div"),this.headerNode.className="jp-JSONEditor-header",this.revertButtonNode=S.undoIcon.element({tag:"span",title:this._trans.__("Revert changes to data")}),this.commitButtonNode=S.checkIcon.element({tag:"span",title:this._trans.__("Commit changes to data"),marginLeft:"8px"}),this.editorHostNode=document.createElement("div"),this.editorHostNode.className="jp-JSONEditor-host",this.headerNode.appendChild(this.revertButtonNode),this.headerNode.appendChild(this.commitButtonNode),this.node.appendChild(this.headerNode),this.node.appendChild(this.editorHostNode);const t=new c.p.Model;t.value.text=this._trans.__("No data!"),t.mimeType="application/json",t.value.changed.connect(this._onValueChanged,this),this.model=t,this.editor=e.editorFactory({host:this.editorHostNode,model:t}),this.editor.setOption("readOnly",!0)}get source(){return this._source}set source(e){this._source!==e&&(this._source&&this._source.changed.disconnect(this._onSourceChanged,this),this._source=e,this.editor.setOption("readOnly",null===e),e&&e.changed.connect(this._onSourceChanged,this),this._setValue())}get isDirty(){return this._dataDirty||this._inputDirty}dispose(){this.isDisposed||(this.model.sharedModel.dispose(),this.model.dispose(),this.editor.dispose(),super.dispose())}handleEvent(e){switch(e.type){case"blur":this._evtBlur(e);break;case"click":this._evtClick(e)}}onAfterAttach(e){const t=this.editorHostNode;t.addEventListener("blur",this,!0),t.addEventListener("click",this,!0),this.revertButtonNode.hidden=!0,this.commitButtonNode.hidden=!0,this.headerNode.addEventListener("click",this),this.isVisible&&this.update()}onAfterShow(e){this.update()}onUpdateRequest(e){this.editor.refresh()}onBeforeDetach(e){const t=this.editorHostNode;t.removeEventListener("blur",this,!0),t.removeEventListener("click",this,!0),this.headerNode.removeEventListener("click",this)}_onSourceChanged(e,t){this._changeGuard||(this._inputDirty||this.editor.hasFocus()?this._dataDirty=!0:this._setValue())}_onValueChanged(){let e=!0;try{const e=JSON.parse(this.editor.model.value.text);this.removeClass(xe),this._inputDirty=!this._changeGuard&&!s.JSONExt.deepEqual(e,this._originalValue)}catch(t){this.addClass(xe),this._inputDirty=!0,e=!1}this.revertButtonNode.hidden=!this._inputDirty,this.commitButtonNode.hidden=!e||!this._inputDirty}_evtBlur(e){!this._inputDirty&&this._dataDirty&&this._setValue()}_evtClick(e){const t=e.target;this.revertButtonNode.contains(t)?this._setValue():this.commitButtonNode.contains(t)?this.commitButtonNode.hidden||this.hasClass(xe)||(this._changeGuard=!0,this._mergeContent(),this._changeGuard=!1,this._setValue()):this.editorHostNode.contains(t)&&this.editor.focus()}_mergeContent(){const e=this.editor.model,t=this._originalValue,n=JSON.parse(e.value.text),o=this.source;if(o){for(const e in n)s.JSONExt.deepEqual(n[e],t[e]||null)||o.set(e,n[e]);for(const e in t)e in n||o.delete(e)}}_setValue(){this._dataDirty=!1,this._inputDirty=!1,this.revertButtonNode.hidden=!0,this.commitButtonNode.hidden=!0,this.removeClass(xe);const e=this.editor.model,t=this._source?this._source.toJSON():{};if(this._changeGuard=!0,void 0===t)e.value.text=this._trans.__("No data!"),this._originalValue=s.JSONExt.emptyObject;else{const n=JSON.stringify(t,null,4);e.value.text=n,this._originalValue=t,n.length>1&&"{"===n[0]&&this.editor.setCursorPosition({line:0,column:1})}this.editor.refresh(),this._changeGuard=!1,this.commitButtonNode.hidden=!0,this.revertButtonNode.hidden=!0}}var Ee,Me=n(41165),De=n(78695),Ne=n(32886);class Ie extends E.Widget{constructor(){super(),this._items=[],this.layout=new E.PanelLayout,this.addClass("jp-RankedPanel")}addWidget(e,t){const n={widget:e,rank:t},o=x.ArrayExt.upperBound(this._items,n,Ee.itemCmp);x.ArrayExt.insert(this._items,o,n),this.layout.insertWidget(o,e)}onChildRemoved(e){const t=x.ArrayExt.findFirstIndex(this._items,(t=>t.widget===e.child));-1!==t&&x.ArrayExt.removeAt(this._items,t)}}class Ae extends E.Widget{constructor(e){super(),this.addClass("jp-NotebookTools"),this.translator=e.translator||de.nullTranslator,this._trans=this.translator.load("jupyterlab"),this._commonTools=new Ie,this._advancedTools=new Ie,this._advancedTools.title.label=this._trans.__("Advanced Tools");const t=this.layout=new E.PanelLayout;t.addWidget(this._commonTools),t.addWidget(new o.Collapse({widget:this._advancedTools})),this._tracker=e.tracker,this._tracker.currentChanged.connect(this._onActiveNotebookPanelChanged,this),this._tracker.activeCellChanged.connect(this._onActiveCellChanged,this),this._tracker.selectionChanged.connect(this._onSelectionChanged,this),this._onActiveNotebookPanelChanged(),this._onActiveCellChanged(),this._onSelectionChanged()}get activeCell(){return this._tracker.activeCell}get selectedCells(){const e=this._tracker.currentWidget;if(!e)return[];const t=e.content;return t.widgets.filter((e=>t.isSelectedOrActive(e)))}get activeNotebookPanel(){return this._tracker.currentWidget}addItem(e){var t;const n=e.tool,o=null!==(t=e.rank)&&void 0!==t?t:100;let s;s="advanced"===e.section?this._advancedTools:this._commonTools,n.addClass("jp-NotebookTools-tool"),s.addWidget(n,o),n.notebookTools=this,De.MessageLoop.sendMessage(n,Ae.ActiveNotebookPanelMessage),De.MessageLoop.sendMessage(n,Ae.ActiveCellMessage)}_onActiveNotebookPanelChanged(){this._prevActiveNotebookModel&&!this._prevActiveNotebookModel.isDisposed&&this._prevActiveNotebookModel.metadata.changed.disconnect(this._onActiveNotebookPanelMetadataChanged,this);const e=this.activeNotebookPanel&&this.activeNotebookPanel.content?this.activeNotebookPanel.content.model:null;this._prevActiveNotebookModel=e,e&&e.metadata.changed.connect(this._onActiveNotebookPanelMetadataChanged,this),(0,x.each)(this._toolChildren(),(e=>{De.MessageLoop.sendMessage(e,Ae.ActiveNotebookPanelMessage)}))}_onActiveCellChanged(){this._prevActiveCell&&!this._prevActiveCell.isDisposed&&this._prevActiveCell.metadata.changed.disconnect(this._onActiveCellMetadataChanged,this);const e=this.activeCell?this.activeCell.model:null;this._prevActiveCell=e,e&&e.metadata.changed.connect(this._onActiveCellMetadataChanged,this),(0,x.each)(this._toolChildren(),(e=>{De.MessageLoop.sendMessage(e,Ae.ActiveCellMessage)}))}_onSelectionChanged(){(0,x.each)(this._toolChildren(),(e=>{De.MessageLoop.sendMessage(e,Ae.SelectionMessage)}))}_onActiveNotebookPanelMetadataChanged(e,t){const n=new Me.T.ChangeMessage("activenotebookpanel-metadata-changed",t);(0,x.each)(this._toolChildren(),(e=>{De.MessageLoop.sendMessage(e,n)}))}_onActiveCellMetadataChanged(e,t){const n=new Me.T.ChangeMessage("activecell-metadata-changed",t);(0,x.each)(this._toolChildren(),(e=>{De.MessageLoop.sendMessage(e,n)}))}_toolChildren(){return(0,x.chain)(this._commonTools.children(),this._advancedTools.children())}}!function(e){e.ActiveNotebookPanelMessage=new De.ConflatableMessage("activenotebookpanel-changed"),e.ActiveCellMessage=new De.ConflatableMessage("activecell-changed"),e.SelectionMessage=new De.ConflatableMessage("selection-changed");class t extends E.Widget{dispose(){super.dispose(),this.notebookTools&&(this.notebookTools=null)}processMessage(e){switch(super.processMessage(e),e.type){case"activenotebookpanel-changed":this.onActiveNotebookPanelChanged(e);break;case"activecell-changed":this.onActiveCellChanged(e);break;case"selection-changed":this.onSelectionChanged(e);break;case"activecell-metadata-changed":this.onActiveCellMetadataChanged(e);break;case"activenotebookpanel-metadata-changed":this.onActiveNotebookPanelMetadataChanged(e)}}onActiveNotebookPanelChanged(e){}onActiveCellChanged(e){}onSelectionChanged(e){}onActiveCellMetadataChanged(e){}onActiveNotebookPanelMetadataChanged(e){}}e.Tool=t,e.ActiveCellTool=class extends t{constructor(){super(),this._model=new c.p.Model,this.addClass("jp-ActiveCellTool"),this.addClass("jp-InputArea"),this.layout=new E.PanelLayout}dispose(){null!==this._model&&(this._model.dispose(),this._model=null,super.dispose())}onActiveCellChanged(){const e=this.notebookTools.activeCell,t=this.layout,n=t.widgets.length;for(let e=0;e<n;e++)t.widgets[0].dispose();if(this._cellModel&&!this._cellModel.isDisposed&&(this._cellModel.value.changed.disconnect(this._onValueChanged,this),this._cellModel.mimeTypeChanged.disconnect(this._onMimeTypeChanged,this)),!e){const e=new E.Widget;return e.addClass("jp-InputArea-editor"),e.addClass("jp-InputArea-editor"),t.addWidget(e),void(this._cellModel=null)}const o=e.promptNode?e.promptNode.cloneNode(!0):void 0,s=new E.Widget({node:o}),i=e.contentFactory.editorFactory,a=this._cellModel=e.model;a.value.changed.connect(this._onValueChanged,this),a.mimeTypeChanged.connect(this._onMimeTypeChanged,this),this._model.value.text=a.value.text.split("\n")[0],this._model.mimeType=a.mimeType;const l=this._model,d=new V({model:l,factory:i});d.addClass("jp-InputArea-editor"),d.addClass("jp-InputArea-editor"),d.editor.setOption("readOnly",!0),t.addWidget(s),t.addWidget(d)}onActiveNotebookPanelChanged(e){this.notebookTools.activeNotebookPanel||this.onActiveCellChanged()}_onValueChanged(){this._model.value.text=this._cellModel.value.text.split("\n")[0]}_onMimeTypeChanged(){this._model.mimeType=this._cellModel.mimeType}};class n extends t{constructor(e){super();const{editorFactory:t}=e;this.addClass("jp-MetadataEditorTool");const n=this.layout=new E.PanelLayout;this._editorFactory=t,this._editorLabel=e.label||"Edit Metadata",this.createEditor();const o=new E.Widget({node:document.createElement("label")});o.node.textContent=e.label||"Edit Metadata",n.addWidget(o),n.addWidget(this.editor)}get editor(){return this._editor}onActiveNotebookPanelChanged(e){this.editor.dispose(),this.notebookTools.activeNotebookPanel&&this.createEditor()}createEditor(){this._editor=new Oe({editorFactory:this._editorFactory}),this.editor.title.label=this._editorLabel,this.layout.addWidget(this.editor)}}e.MetadataEditorTool=n,e.NotebookMetadataEditorTool=class extends n{constructor(e){const t=(e.translator||de.nullTranslator).load("jupyterlab");e.label=e.label||t.__("Notebook Metadata"),super(e)}onActiveNotebookPanelChanged(e){super.onActiveNotebookPanelChanged(e),this._update()}onActiveNotebookPanelMetadataChanged(e){this._update()}_update(){var e,t;const n=this.notebookTools.activeNotebookPanel&&this.notebookTools.activeNotebookPanel.content;this.editor.source=null!==(t=null===(e=null==n?void 0:n.model)||void 0===e?void 0:e.metadata)&&void 0!==t?t:null}},e.CellMetadataEditorTool=class extends n{constructor(e){const t=(e.translator||de.nullTranslator).load("jupyterlab");e.label=e.label||t.__("Cell Metadata"),super(e)}onActiveCellChanged(e){this.editor.dispose(),this.notebookTools.activeCell&&this.createEditor(),this._update()}onActiveCellMetadataChanged(e){this._update()}_update(){const e=this.notebookTools.activeCell;this.editor.source=e?e.model.metadata:null}};class o extends t{constructor(e){super({node:Ee.createSelectorNode(e)}),this._getValue=e=>{let t=e.model.metadata.get(this.key);return void 0===t&&(t=this._default),t},this._setValue=(e,t)=>{t===this._default?e.model.metadata.delete(this.key):e.model.metadata.set(this.key,t)},this._changeGuard=!1,this.addClass("jp-KeySelector"),this.key=e.key,this._default=e.default,this._validCellTypes=e.validCellTypes||[],this._getter=e.getter||this._getValue,this._setter=e.setter||this._setValue}get selectNode(){return this.node.getElementsByTagName("select")[0]}handleEvent(e){"change"===e.type&&this.onValueChanged()}onAfterAttach(e){this.selectNode.addEventListener("change",this)}onBeforeDetach(e){this.selectNode.removeEventListener("change",this)}onActiveCellChanged(e){const t=this.selectNode,n=this.notebookTools.activeCell;if(!n)return t.disabled=!0,void(t.value="");const o=n.model.type;if(this._validCellTypes.length&&-1===this._validCellTypes.indexOf(o))return t.value="",void(t.disabled=!0);t.disabled=!1,this._changeGuard=!0;const s=this._getter;t.value=JSON.stringify(s(n)),this._changeGuard=!1}onActiveCellMetadataChanged(e){if(this._changeGuard)return;const t=this.selectNode,n=this.notebookTools.activeCell;if(e.args.key===this.key&&n){this._changeGuard=!0;const e=this._getter;t.value=JSON.stringify(e(n)),this._changeGuard=!1}}onValueChanged(){const e=this.notebookTools.activeCell;if(!e||this._changeGuard)return;this._changeGuard=!0;const t=this.selectNode;(0,this._setter)(e,JSON.parse(t.value)),this._changeGuard=!1}}e.KeySelector=o,e.createSlideShowSelector=function(e){const t=(e=e||de.nullTranslator).load("jupyterlab");t.__("");const n={key:"slideshow",title:t.__("Slide Type"),optionValueArray:[["-",null],[t.__("Slide"),"slide"],[t.__("Sub-Slide"),"subslide"],[t.__("Fragment"),"fragment"],[t.__("Skip"),"skip"],[t.__("Notes"),"notes"]],getter:e=>{const t=e.model.metadata.get("slideshow");return t&&t.slide_type},setter:(e,t)=>{let n=e.model.metadata.get("slideshow")||Object.create(null);null===t?(n=Object.assign({},n),delete n.slide_type):n=Object.assign(Object.assign({},n),{slide_type:t}),Object.keys(n).length>0?e.model.metadata.set("slideshow",n):e.model.metadata.delete("slideshow")}};return new o(n)},e.createNBConvertSelector=function(e,t){const n=(t=t||de.nullTranslator).load("jupyterlab");return new o({key:"raw_mimetype",title:n.__("Raw NBConvert Format"),optionValueArray:e,validCellTypes:["raw"]})}}(Ae||(Ae={})),function(e){e.itemCmp=function(e,t){return e.rank-t.rank},e.createSelectorNode=function(e){const t=e.key,n=e.title||t[0].toLocaleUpperCase()+t.slice(1),s=[];let i,a;(0,x.each)(e.optionValueArray,(e=>{a=e[0],i=JSON.stringify(e[1]),s.push(Ne.h.option({value:i},a))}));const l=Ne.VirtualDOM.realize(Ne.h.div({},Ne.h.label(n,Ne.h.select({},s))));return o.Styling.styleNode(l),l}}(Ee||(Ee={}));var Te=n(77968),Fe=n(3860),je=n(24629);const Re="jp-Notebook-cell",Pe="jp-mod-editMode",Be="jp-mod-commandMode",Le="jp-mod-active",Ve="jp-mod-selected",He="jp-mod-multiSelected",We="jp-mod-dropTarget",Je="jp-mod-dropSource",Ue="jp-dragImage",ze="jp-dragImage-content",Ge="jp-dragImage-prompt",$e="jp-dragImage-multipleBack",Ke="application/vnd.jupyter.cells",qe="jp-mod-sideBySide";void 0===window.requestIdleCallback&&(window.requestIdleCallback=function(e){let t=Date.now();return setTimeout((function(){e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-t))}})}),1)},window.cancelIdleCallback=function(e){clearTimeout(e)});class Ye extends E.Widget{constructor(e){var t,n;super(),this._editorConfig=Ye.defaultEditorConfig,this._notebookConfig=Ye.defaultNotebookConfig,this._mimetype="text/plain",this._model=null,this._modelChanged=new i.Signal(this),this._modelContentChanged=new i.Signal(this),this._fullyRendered=new i.Signal(this),this._placeholderCellRendered=new i.Signal(this),this._renderedCellsCount=0,this._renderingLayoutChanged=new i.Signal(this),this.addClass("jp-Notebook"),this.node.dataset.jpKernelUser="true",this.node.dataset.jpUndoer="true",this.node.dataset.jpCodeRunner="true",this.rendermime=e.rendermime,this.translator=null!==(t=e.translator)&&void 0!==t?t:de.nullTranslator,this.layout=new Qe.NotebookPanelLayout,this.contentFactory=e.contentFactory||Ye.defaultContentFactory,this.editorConfig=e.editorConfig||Ye.defaultEditorConfig,this.notebookConfig=e.notebookConfig||Ye.defaultNotebookConfig,this._mimetypeService=e.mimeTypeService,this.renderingLayout=null===(n=e.notebookConfig)||void 0===n?void 0:n.renderingLayout,this._idleCallBack=null,this._toRenderMap=new Map,"IntersectionObserver"in window&&(this._observer=new IntersectionObserver(((e,t)=>{e.forEach((e=>{if(e.isIntersecting){t.unobserve(e.target);const n=this._toRenderMap.get(e.target.id);if(n){const{cell:e,index:t}=n;this._renderPlaceholderCell(e,t)}}}))}),{root:this.node,threshold:1,rootMargin:`${this.notebookConfig.observedTopMargin} 0px ${this.notebookConfig.observedBottomMargin} 0px`}))}get fullyRendered(){return this._fullyRendered}get placeholderCellRendered(){return this._placeholderCellRendered}get modelChanged(){return this._modelChanged}get modelContentChanged(){return this._modelContentChanged}get renderingLayoutChanged(){return this._renderingLayoutChanged}get model(){return this._model}set model(e){if(e=e||null,this._model===e)return;const t=this._model;this._model=e,t&&t.modelDB.isCollaborative&&t.modelDB.connected.then((()=>{t.modelDB.collaborators.changed.disconnect(this._onCollaboratorsChanged,this)})),e&&e.modelDB.isCollaborative&&e.modelDB.connected.then((()=>{e.modelDB.collaborators.changed.connect(this._onCollaboratorsChanged,this)})),this._onModelChanged(t,e),this.onModelChanged(t,e),this._modelChanged.emit(void 0)}get codeMimetype(){return this._mimetype}get widgets(){return this.layout.widgets}get editorConfig(){return this._editorConfig}set editorConfig(e){this._editorConfig=e,this._updateEditorConfig()}get notebookConfig(){return this._notebookConfig}set notebookConfig(e){this._notebookConfig=e,this._updateNotebookConfig()}get renderingLayout(){return this._renderingLayout}set renderingLayout(e){var t;this._renderingLayout=e,"side-by-side"===this._renderingLayout?this.node.classList.add(qe):this.node.classList.remove(qe),this._renderingLayoutChanged.emit(null!==(t=this._renderingLayout)&&void 0!==t?t:"default")}dispose(){this.isDisposed||(this._model=null,super.dispose())}onModelChanged(e,t){}onModelContentChanged(e,t){this._modelContentChanged.emit(void 0)}onMetadataChanged(e,t){"language_info"===t.key&&this._updateMimetype()}onCellInserted(e,t){}onCellMoved(e,t){}onCellRemoved(e,t){}_onModelChanged(e,t){const n=this.layout;if(e)for(e.cells.changed.disconnect(this._onCellsChanged,this),e.metadata.changed.disconnect(this.onMetadataChanged,this),e.contentChanged.disconnect(this.onModelContentChanged,this);n.widgets.length;)this._removeCell(0);if(!t)return void(this._mimetype="text/plain");this._updateMimetype();const o=t.cells;!o.length&&t.isInitialized&&o.push(t.contentFactory.createCell(this.notebookConfig.defaultCell,{})),(0,x.each)(o,((e,t)=>{this._insertCell(t,e,"set")})),o.changed.connect(this._onCellsChanged,this),t.contentChanged.connect(this.onModelContentChanged,this),t.metadata.changed.connect(this.onMetadataChanged,this)}_onCellsChanged(e,t){let n=0;switch(t.type){case"add":n=t.newIndex;const o=-1==t.oldIndex?"push":"insert";(0,x.each)(t.newValues,(e=>{this._insertCell(n++,e,o)}));break;case"move":this._moveCell(t.oldIndex,t.newIndex);break;case"remove":if((0,x.each)(t.oldValues,(e=>{this._removeCell(t.oldIndex)})),!e.length){const e=this.model;requestAnimationFrame((()=>{!e||e.isDisposed||e.cells.length||e.cells.push(e.contentFactory.createCell(this.notebookConfig.defaultCell,{}))}))}break;case"set":n=t.newIndex,(0,x.each)(t.newValues,(e=>{this._insertCell(n,e,"set"),this._removeCell(n+1),n++}));break;default:return}}_insertCell(e,t,n){let o;switch(t.type){case"code":o=this._createCodeCell(t),o.model.mimeType=this._mimetype;break;case"markdown":o=this._createMarkdownCell(t),""===t.value.text&&(o.rendered=!1);break;default:o=this._createRawCell(t)}o.addClass(Re);const s=this.layout;if(this._observer&&"push"===n&&this._renderedCellsCount>=this.notebookConfig.numberCellsToRenderDirectly&&"markdown"!==t.type){this._toRenderMap.set(o.model.id,{index:e,cell:o});const n=this._createPlaceholderCell(t,e);n.node.id=o.model.id,s.insertWidget(e,n),this.onCellInserted(e,n),this._fullyRendered.emit(!1),this._observer.observe(n.node)}else s.insertWidget(e,o),this.onCellInserted(e,o),this._incrementRenderedCount();this._scheduleCellRenderOnIdle()}_scheduleCellRenderOnIdle(){if(this._observer&&this.notebookConfig.renderCellOnIdle&&!this.isDisposed&&!this._idleCallBack){const e=this._renderPlaceholderCells.bind(this);this._idleCallBack=window.requestIdleCallback(e,{timeout:3e3})}}_renderPlaceholderCells(e){var t,n;if(this.notebookConfig.remainingTimeBeforeRescheduling>0){const t=e.timeRemaining();(e.didTimeout||t<this.notebookConfig.remainingTimeBeforeRescheduling)&&(this._idleCallBack&&(window.cancelIdleCallback(this._idleCallBack),this._idleCallBack=null),this._scheduleCellRenderOnIdle())}if(this._renderedCellsCount<(null!==(n=null===(t=this.model)||void 0===t?void 0:t.cells.length)&&void 0!==n?n:0)&&this._renderedCellsCount>=this.notebookConfig.numberCellsToRenderDirectly){const e=this._toRenderMap.entries().next();this._renderPlaceholderCell(e.value[1].cell,e.value[1].index)}}_renderPlaceholderCell(e,t){if(!this.layout)return;const n=this.layout;n.removeWidgetAt(t),n.insertWidget(t,e),this._toRenderMap.delete(e.model.id),this._incrementRenderedCount(),this.onCellInserted(t,e),this._placeholderCellRendered.emit(e)}_createCodeCell(e){const t=this.rendermime,n=this.contentFactory,o={editorConfig:this.editorConfig.code,model:e,rendermime:t,contentFactory:n,updateEditorOnShow:!1,placeholder:!1,maxNumberOutputs:this.notebookConfig.maxNumberOutputs},s=this.contentFactory.createCodeCell(o,this);return s.syncCollapse=!0,s.syncEditable=!0,s.syncScrolled=!0,s}_createMarkdownCell(e){const t=this.rendermime,n=this.contentFactory,o={editorConfig:this.editorConfig.markdown,model:e,rendermime:t,contentFactory:n,updateEditorOnShow:!1,placeholder:!1,showEditorForReadOnlyMarkdown:this._notebookConfig.showEditorForReadOnlyMarkdown},s=this.contentFactory.createMarkdownCell(o,this);return s.syncCollapse=!0,s.syncEditable=!0,s.toggleCollapsedSignal.connect(((e,t)=>{he.setHeadingCollapse(e,t,this)})),s}_createPlaceholderCell(e,t){const n=this.contentFactory,o={editorConfig:this.editorConfig.raw,model:e,contentFactory:n,updateEditorOnShow:!1,placeholder:!0},s=this.contentFactory.createRawCell(o,this);return s.node.innerHTML='\n      <div class="jp-Cell-Placeholder">\n        <div class="jp-Cell-Placeholder-wrapper">\n        </div>\n      </div>',s.inputHidden=!0,s.syncCollapse=!0,s.syncEditable=!0,s}_createRawCell(e){const t=this.contentFactory,n={editorConfig:this.editorConfig.raw,model:e,contentFactory:t,updateEditorOnShow:!1,placeholder:!1},o=this.contentFactory.createRawCell(n,this);return o.syncCollapse=!0,o.syncEditable=!0,o}_moveCell(e,t){const n=this.layout;n.insertWidget(t,n.widgets[e]),this.onCellMoved(e,t)}_removeCell(e){const t=this.layout.widgets[e];t.parent=null,this.onCellRemoved(e,t),t.dispose()}_updateMimetype(){var e;const t=null===(e=this._model)||void 0===e?void 0:e.metadata.get("language_info");t&&(this._mimetype=this._mimetypeService.getMimeTypeByLanguage(t),(0,x.each)(this.widgets,(e=>{"code"===e.model.type&&(e.model.mimeType=this._mimetype)})))}_onCollaboratorsChanged(){var e,t,n;for(let o=0;o<this.widgets.length;o++){const s=this.widgets[o];for(const o of s.model.selections.keys())!1===(null===(n=null===(t=null===(e=this._model)||void 0===e?void 0:e.modelDB)||void 0===t?void 0:t.collaborators)||void 0===n?void 0:n.has(o))&&s.model.selections.delete(o)}}_updateEditorConfig(){for(let e=0;e<this.widgets.length;e++){const t=this.widgets[e];let n={};switch(t.model.type){case"code":n=this._editorConfig.code;break;case"markdown":n=this._editorConfig.markdown;break;default:n=this._editorConfig.raw}t.editor.setOptions(Object.assign({},n)),t.editor.refresh()}}_updateNotebookConfig(){this.toggleClass("jp-mod-scrollPastEnd",this._notebookConfig.scrollPastEnd);const e=this._notebookConfig.showEditorForReadOnlyMarkdown;if(void 0!==e)for(const t of this.widgets)"markdown"===t.model.type&&(t.showEditorForReadOnly=e)}_incrementRenderedCount(){0===this._toRenderMap.size&&this._fullyRendered.emit(!0),this._renderedCellsCount++}get remainingCellToRenderCount(){return this._toRenderMap.size}}!function(e){e.defaultEditorConfig={code:Object.assign(Object.assign({},c.p.defaultConfig),{lineWrap:"off",matchBrackets:!0,autoClosingBrackets:!1}),markdown:Object.assign(Object.assign({},c.p.defaultConfig),{lineWrap:"on",matchBrackets:!1,autoClosingBrackets:!1}),raw:Object.assign(Object.assign({},c.p.defaultConfig),{lineWrap:"on",matchBrackets:!1,autoClosingBrackets:!1})},e.defaultNotebookConfig={scrollPastEnd:!0,defaultCell:"code",recordTiming:!1,numberCellsToRenderDirectly:99999,remainingTimeBeforeRescheduling:50,renderCellOnIdle:!0,observedTopMargin:"1000px",observedBottomMargin:"1000px",maxNumberOutputs:50,showEditorForReadOnlyMarkdown:!0,disableDocumentWideUndoRedo:!1,renderingLayout:"default",sideBySideLeftMarginOverride:"10px",sideBySideRightMarginOverride:"10px",sideBySideOutputRatio:1};class t extends oe.ContentFactory{createCodeCell(e,t){return e.contentFactory||(e.contentFactory=this),new se(e).initializeState()}createMarkdownCell(e,t){return e.contentFactory||(e.contentFactory=this),new ae(e).initializeState()}createRawCell(e,t){return e.contentFactory||(e.contentFactory=this),new le(e).initializeState()}}e.ContentFactory=t,e.defaultContentFactory=new t}(Ye||(Ye={}));class Xe extends Ye{constructor(e){super(Qe.processNotebookOptions(e)),this._activeCellIndex=-1,this._activeCell=null,this._mode="command",this._drag=null,this._fragment="",this._dragData=null,this._mouseMode=null,this._activeCellChanged=new i.Signal(this),this._stateChanged=new i.Signal(this),this._selectionChanged=new i.Signal(this),this._checkCacheOnNextResize=!1,this._lastClipboardInteraction=null,this.node.tabIndex=0,this.node.setAttribute("data-lm-dragscroll","true")}get activeCellChanged(){return this._activeCellChanged}get stateChanged(){return this._stateChanged}get selectionChanged(){return this._selectionChanged}get mode(){return this._mode}set mode(e){const t=this.activeCell;if(t||(e="command"),e===this._mode)return void this._ensureFocus();this.update();const n=this._mode;this._mode=e,"edit"===e?((0,x.each)(this.widgets,(e=>{this.deselect(e)})),t instanceof ae&&(t.rendered=!1),t.inputHidden=!1):this.node.focus(),this._stateChanged.emit({name:"mode",oldValue:n,newValue:e}),this._ensureFocus()}get activeCellIndex(){return this.model&&this.model.cells.length?this._activeCellIndex:-1}set activeCellIndex(e){const t=this._activeCellIndex;this.model&&this.model.cells.length?(e=Math.max(e,0),e=Math.min(e,this.model.cells.length-1)):e=-1,this._activeCellIndex=e;const n=this.widgets[e];n!==this._activeCell&&(this.update(),this._activeCell=n,this._activeCellChanged.emit(n)),"edit"===this.mode&&n instanceof ae&&(n.rendered=!1),this._ensureFocus(),e!==t&&(this._trimSelections(),this._stateChanged.emit({name:"activeCellIndex",oldValue:t,newValue:e}))}get activeCell(){return this._activeCell}get lastClipboardInteraction(){return this._lastClipboardInteraction}set lastClipboardInteraction(e){this._lastClipboardInteraction=e}dispose(){this.isDisposed||(this._activeCell=null,super.dispose())}select(e){Qe.selectedProperty.get(e)||(Qe.selectedProperty.set(e,!0),this._selectionChanged.emit(void 0),this.update())}deselect(e){Qe.selectedProperty.get(e)&&(Qe.selectedProperty.set(e,!1),this._selectionChanged.emit(void 0),this.update())}isSelected(e){return Qe.selectedProperty.get(e)}isSelectedOrActive(e){return e===this._activeCell||Qe.selectedProperty.get(e)}deselectAll(){let e=!1;(0,x.each)(this.widgets,(t=>{Qe.selectedProperty.get(t)&&(e=!0),Qe.selectedProperty.set(t,!1)})),e&&this._selectionChanged.emit(void 0),this.activeCellIndex=this.activeCellIndex,this.update()}extendContiguousSelectionTo(e){let t,{head:n,anchor:o}=this.getContiguousSelection();if(null===o||null===n){if(e===this.activeCellIndex)return;n=this.activeCellIndex,o=this.activeCellIndex}if(this.activeCellIndex=e,(e=this.activeCellIndex)===o)return void this.deselectAll();let s=!1;if(n<e)for(n<o&&(Qe.selectedProperty.set(this.widgets[n],!1),s=!0),t=n+1;t<e;t++)t!==o&&(Qe.selectedProperty.set(this.widgets[t],!Qe.selectedProperty.get(this.widgets[t])),s=!0);else if(e<n)for(o<n&&(Qe.selectedProperty.set(this.widgets[n],!1),s=!0),t=e+1;t<n;t++)t!==o&&(Qe.selectedProperty.set(this.widgets[t],!Qe.selectedProperty.get(this.widgets[t])),s=!0);Qe.selectedProperty.get(this.widgets[o])||(s=!0),Qe.selectedProperty.set(this.widgets[o],!0),Qe.selectedProperty.get(this.widgets[e])||(s=!0),Qe.selectedProperty.set(this.widgets[e],!0),s&&this._selectionChanged.emit(void 0)}getContiguousSelection(){const e=this.widgets,t=x.ArrayExt.findFirstIndex(e,(e=>this.isSelected(e)));if(-1===t)return{head:null,anchor:null};const n=x.ArrayExt.findLastIndex(e,(e=>this.isSelected(e)),-1,t);for(let o=t;o<=n;o++)if(!this.isSelected(e[o]))throw new Error("Selection not contiguous");const o=this.activeCellIndex;if(t!==o&&n!==o)throw new Error("Active cell not at endpoint of selection");return t===o?{head:t,anchor:n}:{head:n,anchor:t}}scrollToPosition(e,t=25){const n=this.node,o=n.getBoundingClientRect(),s=e-o.top-o.height/2;Math.abs(s)>o.height*t/100&&(n.scrollTop+=s)}scrollToCell(e){M.ElementExt.scrollIntoViewIfNeeded(this.node,e.node),this.deselectAll(),this.select(e),e.activate()}setFragment(e){Promise.all(this.widgets.map((e=>e.ready))).then((()=>{this._fragment=e,this.update()}))}handleEvent(e){if(this.model)switch(e.type){case"contextmenu":e.eventPhase===Event.CAPTURING_PHASE&&this._evtContextMenuCapture(e);break;case"mousedown":e.eventPhase===Event.CAPTURING_PHASE?this._evtMouseDownCapture(e):this._evtMouseDown(e);break;case"mouseup":e.currentTarget===document&&this._evtDocumentMouseup(e);break;case"mousemove":e.currentTarget===document&&this._evtDocumentMousemove(e);break;case"keydown":this._ensureFocus(!0);break;case"dblclick":this._evtDblClick(e);break;case"focusin":this._evtFocusIn(e);break;case"focusout":this._evtFocusOut(e);break;case"lm-dragenter":this._evtDragEnter(e);break;case"lm-dragleave":this._evtDragLeave(e);break;case"lm-dragover":this._evtDragOver(e);break;case"lm-drop":this._evtDrop(e)}}onAfterAttach(e){super.onAfterAttach(e);const t=this.node;t.addEventListener("contextmenu",this,!0),t.addEventListener("mousedown",this,!0),t.addEventListener("mousedown",this),t.addEventListener("keydown",this),t.addEventListener("dblclick",this),t.addEventListener("focusin",this),t.addEventListener("focusout",this),t.addEventListener("lm-dragenter",this,!0),t.addEventListener("lm-dragleave",this,!0),t.addEventListener("lm-dragover",this,!0),t.addEventListener("lm-drop",this,!0)}onBeforeDetach(e){const t=this.node;t.removeEventListener("contextmenu",this,!0),t.removeEventListener("mousedown",this,!0),t.removeEventListener("mousedown",this),t.removeEventListener("keydown",this),t.removeEventListener("dblclick",this),t.removeEventListener("focusin",this),t.removeEventListener("focusout",this),t.removeEventListener("lm-dragenter",this,!0),t.removeEventListener("lm-dragleave",this,!0),t.removeEventListener("lm-dragover",this,!0),t.removeEventListener("lm-drop",this,!0),document.removeEventListener("mousemove",this,!0),document.removeEventListener("mouseup",this,!0)}onAfterShow(e){this._checkCacheOnNextResize=!0}onResize(e){if(!this._checkCacheOnNextResize)return super.onResize(e);this._checkCacheOnNextResize=!1;const t=this._cellLayoutStateCache,n=parseInt(this.node.style.width,10);if(!t||n!==t.width){this._cellLayoutStateCache={width:n};for(const e of this.widgets)e instanceof oe&&e.editorWidget.update()}}onBeforeHide(e){const t=parseInt(this.node.style.width,10);this._cellLayoutStateCache={width:t}}onActivateRequest(e){this._ensureFocus(!0)}onUpdateRequest(e){const t=this.activeCell;"edit"===this.mode?(this.addClass(Pe),this.removeClass(Be)):(this.addClass(Be),this.removeClass(Pe)),t&&t.addClass(Le);let n=0;if((0,x.each)(this.widgets,(e=>{e!==t&&e.removeClass(Le),e.removeClass(He),this.isSelectedOrActive(e)?(e.addClass(Ve),n++):e.removeClass(Ve)})),n>1&&(null==t||t.addClass(He)),this._fragment){let e;try{e=this.node.querySelector(this._fragment.startsWith("#")?`#${CSS.escape(this._fragment.slice(1))}`:this._fragment)}catch(e){console.warn("Unable to set URI fragment identifier",e)}e&&e.scrollIntoView(),this._fragment=""}}onCellInserted(e,t){if(this.model&&this.model.modelDB.isCollaborative){const e=this.model.modelDB;e.connected.then((()=>{if(!t.isDisposed){const n=e.collaborators.localCollaborator;t.editor.uuid=n.sessionId,t.editor.selectionStyle=Object.assign(Object.assign({},c.p.defaultSelectionStyle),{color:n.color})}}))}t.editor.edgeRequested.connect(this._onEdgeRequest,this),this.activeCellIndex=e<=this.activeCellIndex?this.activeCellIndex+1:this.activeCellIndex}onCellMoved(e,t){const n=this.activeCellIndex;e===n?this.activeCellIndex=t:e<n&&n<=t?this.activeCellIndex--:t<=n&&n<e&&this.activeCellIndex++}onCellRemoved(e,t){this.activeCellIndex=e<=this.activeCellIndex?this.activeCellIndex-1:this.activeCellIndex,this.isSelected(t)&&this._selectionChanged.emit(void 0)}onModelChanged(e,t){super.onModelChanged(e,t),this.activeCellIndex=0}_onEdgeRequest(e,t){const n=this.activeCellIndex;if("top"===t){if(this.activeCellIndex--,this.activeCellIndex<n){const e=this.activeCell.editor,t=e.lineCount-1;e.setCursorPosition({line:t,column:0})}}else"bottom"===t&&(this.activeCellIndex++,this.activeCellIndex>n)&&this.activeCell.editor.setCursorPosition({line:0,column:0});this.mode="edit"}_ensureFocus(e=!1){const t=this.activeCell;"edit"===this.mode&&t&&(t.editor.hasFocus()||t.editor.focus()),e&&!this.node.contains(document.activeElement)&&this.node.focus()}_findCell(e){let t=e;for(;t&&t!==this.node;){if(t.classList.contains(Re)){const e=x.ArrayExt.findFirstIndex(this.widgets,(e=>e.node===t));if(-1!==e)return e;break}t=t.parentElement}return-1}_findEventTargetAndCell(e){let t=e.target,n=this._findCell(t);return-1===n&&(t=document.elementFromPoint(e.clientX,e.clientY),n=this._findCell(t)),[t,n]}_evtContextMenuCapture(e){if(e.shiftKey)return;const[t,n]=this._findEventTargetAndCell(e),o=this.widgets[n];o&&o.editorWidget.node.contains(t)&&e.preventDefault()}_evtMouseDownCapture(e){const{button:t,shiftKey:n}=e,[o,s]=this._findEventTargetAndCell(e),i=this.widgets[s];2===t&&!n&&i&&i.editorWidget.node.contains(o)&&(this.mode="command",e.preventDefault())}_evtMouseDown(e){var t;const{button:n,shiftKey:o}=e;if(0!==n&&2!==n)return;if(o&&2===n)return;const[s,i]=this._findEventTargetAndCell(e),a=this.widgets[i];let l;if(l=a?a.editorWidget.node.contains(s)?"input":a.promptNode.contains(s)?"prompt":"cell":"notebook","input"!==l&&(this.mode="command"),"notebook"===l)this.deselectAll();else if("prompt"===l||"cell"===l){const s=""!==(null!==(t=window.getSelection())&&void 0!==t?t:"").toString();if(0===n&&o&&!s){e.preventDefault();try{this.extendContiguousSelectionTo(i)}catch(e){return console.error(e),void this.deselectAll()}this._mouseMode="select",document.addEventListener("mouseup",this,!0),document.addEventListener("mousemove",this,!0)}else 0!==n||o?2===n&&(this.isSelectedOrActive(a)||(this.deselectAll(),this.activeCellIndex=i),e.preventDefault()):("prompt"===l&&(this._dragData={pressX:e.clientX,pressY:e.clientY,index:i},this._mouseMode="couldDrag",document.addEventListener("mouseup",this,!0),document.addEventListener("mousemove",this,!0),e.preventDefault()),this.isSelectedOrActive(a)||(this.deselectAll(),this.activeCellIndex=i))}else"input"===l&&(2!==n||this.isSelectedOrActive(a)||(this.deselectAll(),this.activeCellIndex=i));this._ensureFocus(!0)}_evtDocumentMouseup(e){if(e.preventDefault(),e.stopPropagation(),document.removeEventListener("mousemove",this,!0),document.removeEventListener("mouseup",this,!0),"couldDrag"===this._mouseMode){const[,t]=this._findEventTargetAndCell(e);this.deselectAll(),this.activeCellIndex=t,this.activeCell.node.contains(document.activeElement)||this.node.focus()}this._mouseMode=null}_evtDocumentMousemove(e){switch(e.preventDefault(),e.stopPropagation(),this._mouseMode){case"select":{const t=e.target,n=this._findCell(t);-1!==n&&this.extendContiguousSelectionTo(n);break}case"couldDrag":{const t=this._dragData,n=Math.abs(e.clientX-t.pressX),o=Math.abs(e.clientY-t.pressY);(n>=5||o>=5)&&(this._mouseMode=null,this._startDrag(t.index,e.clientX,e.clientY));break}}}_evtDragEnter(e){if(!e.mimeData.hasData(Ke))return;e.preventDefault(),e.stopPropagation();const t=e.target,n=this._findCell(t);-1!==n&&this.layout.widgets[n].node.classList.add(We)}_evtDragLeave(e){if(!e.mimeData.hasData(Ke))return;e.preventDefault(),e.stopPropagation();const t=this.node.getElementsByClassName(We);t.length&&t[0].classList.remove(We)}_evtDragOver(e){if(!e.mimeData.hasData(Ke))return;e.preventDefault(),e.stopPropagation(),e.dropAction=e.proposedAction;const t=this.node.getElementsByClassName(We);t.length&&t[0].classList.remove(We);const n=e.target,o=this._findCell(n);-1!==o&&this.layout.widgets[o].node.classList.add(We)}_evtDrop(e){if(!e.mimeData.hasData(Ke))return;if(e.preventDefault(),e.stopPropagation(),"none"===e.proposedAction)return void(e.dropAction="none");let t=e.target;for(;t&&t.parentElement;){if(t.classList.contains(We)){t.classList.remove(We);break}t=t.parentElement}const n=this.model,o=e.source;if(o===this){e.dropAction="move";const s=e.mimeData.getData("internal:cells"),i=s[s.length-1];if(i instanceof ae&&i.headingCollapsed){const e=he.findNextParentHeading(i,o);if(e>0){const t=(0,x.findIndex)(o.widgets,(e=>i.model.id===e.model.id));s.push(...o.widgets.slice(t+1,e))}}let a=x.ArrayExt.firstIndexOf(this.widgets,s[0]),l=this._findCell(t);if(-1!==l&&l>a?l-=1:-1===l&&(l=this.widgets.length-1),l>=a&&l<a+s.length)return;n.cells.beginCompoundOperation(),a<l?(0,x.each)(s,(e=>{n.cells.move(a,l)})):a>l&&(0,x.each)(s,(e=>{n.cells.move(a++,l++)})),n.cells.endCompoundOperation()}else{e.dropAction="copy";let o=this._findCell(t);-1===o&&(o=this.widgets.length);const s=o,i=e.mimeData.getData(Ke),a=n.contentFactory;n.cells.beginCompoundOperation(),(0,x.each)(i,(e=>{let t;switch(e.cell_type){case"code":t=a.createCodeCell({cell:e});break;case"markdown":t=a.createMarkdownCell({cell:e});break;default:t=a.createRawCell({cell:e})}n.cells.insert(o++,t)})),n.cells.endCompoundOperation(),this.deselectAll(),this.activeCellIndex=s,this.extendContiguousSelectionTo(o-1)}}_startDrag(e,t,n){var o;const i=this.model.cells,a=[],l=[];(0,x.each)(this.widgets,((e,t)=>{const n=i.get(t);this.isSelectedOrActive(e)&&(e.addClass(Je),a.push(n.toJSON()),l.push(e))}));const d=this.activeCell;let r,c=null;if("code"===(null==d?void 0:d.model.type)){const e=d.model.executionCount;r=" ",e&&(r=e.toString())}else r="";c=Qe.createDragImage(a.length,r,null!==(o=null==d?void 0:d.model.value.text.split("\n")[0].slice(0,26))&&void 0!==o?o:""),this._drag=new Fe.Drag({mimeData:new s.MimeData,dragImage:c,supportedActions:"copy-move",proposedAction:"copy",source:this}),this._drag.mimeData.setData(Ke,a),this._drag.mimeData.setData("internal:cells",l);const h=l.map((e=>e.model.value.text)).join("\n");this._drag.mimeData.setData("text/plain",h),document.removeEventListener("mousemove",this,!0),document.removeEventListener("mouseup",this,!0),this._mouseMode=null,this._drag.start(t,n).then((e=>{this.isDisposed||(this._drag=null,(0,x.each)(l,(e=>{e.removeClass(Je)})))}))}_evtFocusIn(e){const t=e.target,n=this._findCell(t);if(-1!==n){const e=this.widgets[n];e.editorWidget.node.contains(t)||(this.mode="command"),this.activeCellIndex=n,e.editorWidget.node.contains(t)&&(this.mode="edit"),this.activeCellIndex=n}else this.mode="command"}_evtFocusOut(e){const t=e.relatedTarget;if(!t)return;const n=this._findCell(t);-1!==n&&this.widgets[n].editorWidget.node.contains(t)||"command"!==this.mode&&(this.mode="command",t&&t.focus())}_evtDblClick(e){const t=this.model;if(!t)return;this.deselectAll();const[n,o]=this._findEventTargetAndCell(e);e.target.classList.contains("jp-collapseHeadingButton")||-1===o||(this.activeCellIndex=o,"markdown"===t.cells.get(o).type?this.widgets[o].rendered=!1:"img"===n.localName&&n.classList.toggle("jp-mod-unconfined"))}_trimSelections(){for(let e=0;e<this.widgets.length;e++)if(e!==this._activeCellIndex){const t=this.widgets[e];t.model.selections.delete(t.editor.uuid)}}}var Qe;!function(e){class t extends Ye.ContentFactory{}e.ContentFactory=t,e.defaultContentFactory=new t}(Xe||(Xe={})),function(e){e.selectedProperty=new je.AttachedProperty({name:"selected",create:()=>!1});class t extends E.PanelLayout{onUpdateRequest(e){}}e.NotebookPanelLayout=t,e.createDragImage=function(e,t,n){return e>1?""!==t?Ne.VirtualDOM.realize(Ne.h.div(Ne.h.div({className:Ue},Ne.h.span({className:Ge},"["+t+"]:"),Ne.h.span({className:ze},n)),Ne.h.div({className:$e},""))):Ne.VirtualDOM.realize(Ne.h.div(Ne.h.div({className:Ue},Ne.h.span({className:Ge}),Ne.h.span({className:ze},n)),Ne.h.div({className:$e},""))):""!==t?Ne.VirtualDOM.realize(Ne.h.div(Ne.h.div({className:"jp-dragImage jp-dragImage-singlePrompt"},Ne.h.span({className:Ge},"["+t+"]:"),Ne.h.span({className:ze},n)))):Ne.VirtualDOM.realize(Ne.h.div(Ne.h.div({className:"jp-dragImage jp-dragImage-singlePrompt"},Ne.h.span({className:Ge}),Ne.h.span({className:ze},n))))},e.processNotebookOptions=function(e){return e.contentFactory?e:{rendermime:e.rendermime,languagePreference:e.languagePreference,contentFactory:Xe.defaultContentFactory,mimeTypeService:e.mimeTypeService}}}(Qe||(Qe={}));const Ze="jp-DocumentSearch-document-loaded";class et extends Te.DocumentWidget{constructor(e){super(e),this._autorestarting=!1,this.translator=e.translator||de.nullTranslator,this._trans=this.translator.load("jupyterlab"),this.addClass("jp-NotebookPanel"),this.toolbar.addClass("jp-NotebookPanel-toolbar"),this.content.addClass("jp-NotebookPanel-notebook"),this.content.model=this.context.model,this.context.sessionContext.kernelChanged.connect(this._onKernelChanged,this),this.context.sessionContext.statusChanged.connect(this._onSessionStatusChanged,this),this.content.fullyRendered.connect(this._onFullyRendered,this),this.context.saveState.connect(this._onSave,this),this.revealed.then((()=>{if(!this.isDisposed&&1===this.content.widgets.length){const e=this.content.widgets[0].model;"code"===e.type&&""===e.value.text&&(this.content.mode="edit")}}))}_onSave(e,t){if("started"===t&&this.model){const{cells:e}=this.model;(0,x.each)(e,(e=>{if(p(e))for(const t of e.attachments.keys)e.value.text.includes(t)||e.attachments.remove(t)}))}}get sessionContext(){return this.context.sessionContext}get model(){return this.content.model}setConfig(e){this.content.editorConfig=e.editorConfig,this.content.notebookConfig=e.notebookConfig;const t=this.context.sessionContext.kernelPreference;this.context.sessionContext.kernelPreference=Object.assign(Object.assign({},t),{shutdownOnDispose:e.kernelShutdown})}setFragment(e){this.context.ready.then((()=>{this.content.setFragment(e)}))}dispose(){this.content.dispose(),super.dispose()}[o.Printing.symbol](){return async()=>{this.context.model.dirty&&!this.context.model.readOnly&&await this.context.save(),await o.Printing.printURL(k.PageConfig.getNBConvertURL({format:"html",download:!1,path:this.context.path}))}}_onFullyRendered(e,t){t?this.removeClass(Ze):this.addClass(Ze)}_onKernelChanged(e,t){if(!this.model||!t.newValue)return;const{newValue:n}=t;n.info.then((e=>{var t;this.model&&(null===(t=this.context.sessionContext.session)||void 0===t?void 0:t.kernel)===n&&this._updateLanguage(e.language_info)})),this._updateSpec(n)}_onSessionStatusChanged(e,t){var n;"autorestarting"!==t||this._autorestarting?"restarting"===t||(this._autorestarting=!1):((0,o.showDialog)({title:this._trans.__("Kernel Restarting"),body:this._trans.__("The kernel for %1 appears to have died. It will restart automatically.",null===(n=this.sessionContext.session)||void 0===n?void 0:n.path),buttons:[o.Dialog.okButton({label:this._trans.__("Ok")})]}),this._autorestarting=!0)}_updateLanguage(e){this.model.metadata.set("language_info",e)}async _updateSpec(e){const t=await e.spec;this.isDisposed||this.model.metadata.set("kernelspec",{name:e.name,display_name:null==t?void 0:t.display_name,language:null==t?void 0:t.language})}}!function(e){class t extends Xe.ContentFactory{createNotebook(e){return new Xe(e)}}e.ContentFactory=t,e.defaultContentFactory=new t,e.IContentFactory=new s.Token("@jupyterlab/notebook:IContentFactory")}(et||(et={}));const tt=new s.Token("@jupyterlab/notebook:INotebookWidgetFactory"),nt=new s.Token("@jupyterlab/notebook:INotebookTools"),ot=new s.Token("@jupyterlab/notebook:INotebookTracker");class st extends o.WidgetTracker{constructor(){super(...arguments),this._activeCell=null,this._activeCellChanged=new i.Signal(this),this._selectionChanged=new i.Signal(this)}get activeCell(){const e=this.currentWidget;return e&&e.content.activeCell||null}get activeCellChanged(){return this._activeCellChanged}get selectionChanged(){return this._selectionChanged}add(e){const t=super.add(e);return e.content.activeCellChanged.connect(this._onActiveCellChanged,this),e.content.selectionChanged.connect(this._onSelectionChanged,this),t}dispose(){this._activeCell=null,super.dispose()}onCurrentChanged(e){const t=this.activeCell;t&&t===this._activeCell||(this._activeCell=t,e&&this._activeCellChanged.emit(e.content.activeCell||null))}_onActiveCellChanged(e,t){this.currentWidget&&this.currentWidget.content===e&&(this._activeCell=t||null,this._activeCellChanged.emit(this._activeCell))}_onSelectionChanged(e){this.currentWidget&&this.currentWidget.content===e&&this._selectionChanged.emit(void 0)}}function it(e){return e.allCellsTrusted?N().createElement(S.trustedIcon.react,{top:"2px",stylesheet:"statusBar"}):N().createElement(S.notTrustedIcon.react,{top:"2px",stylesheet:"statusBar"})}class at extends o.VDomRenderer{constructor(e){super(new at.Model),this.translator=e||de.nullTranslator}render(){return this.model?(this.node.title=function(e,t){const n=(t=t||de.nullTranslator).load("jupyterlab");return e.trustedCells===e.totalCells?[n.__("Notebook trusted: %1 of %2 cells trusted.",e.trustedCells,e.totalCells),"jp-StatusItem-trusted"]:e.activeCellTrusted?[n.__("Active cell trusted: %1 of %2 cells trusted.",e.trustedCells,e.totalCells),"jp-StatusItem-trusted"]:[n.__("Notebook not trusted: %1 of %2 cells trusted.",e.trustedCells,e.totalCells),"jp-StatusItem-untrusted"]}(this.model,this.translator)[0],N().createElement("div",null,N().createElement(it,{allCellsTrusted:this.model.trustedCells===this.model.totalCells,activeCellTrusted:this.model.activeCellTrusted,totalCells:this.model.totalCells,trustedCells:this.model.trustedCells}))):null}}!function(e){class t extends o.VDomModel{constructor(){super(...arguments),this._trustedCells=0,this._totalCells=0,this._activeCellTrusted=!1,this._notebook=null}get trustedCells(){return this._trustedCells}get totalCells(){return this._totalCells}get activeCellTrusted(){return this._activeCellTrusted}get notebook(){return this._notebook}set notebook(e){const t=this._notebook;null!==t&&(t.activeCellChanged.disconnect(this._onActiveCellChanged,this),t.modelContentChanged.disconnect(this._onModelChanged,this));const n=this._getAllState();if(this._notebook=e,null===this._notebook)this._trustedCells=0,this._totalCells=0,this._activeCellTrusted=!1;else{this._notebook.activeCellChanged.connect(this._onActiveCellChanged,this),this._notebook.modelContentChanged.connect(this._onModelChanged,this),void 0!==this._notebook.activeCell?this._activeCellTrusted=this._notebook.activeCell.model.trusted:this._activeCellTrusted=!1;const{total:e,trusted:t}=this._deriveCellTrustState(this._notebook.model);this._totalCells=e,this._trustedCells=t}this._triggerChange(n,this._getAllState())}_onModelChanged(e){const t=this._getAllState(),{total:n,trusted:o}=this._deriveCellTrustState(e.model);this._totalCells=n,this._trustedCells=o,this._triggerChange(t,this._getAllState())}_onActiveCellChanged(e,t){const n=this._getAllState();this._activeCellTrusted=!!t&&t.model.trusted,this._triggerChange(n,this._getAllState())}_deriveCellTrustState(e){if(null===e)return{total:0,trusted:0};const t=(0,x.toArray)(e.cells),n=t.reduce(((e,t)=>t.trusted?e+1:e),0);return{total:t.length,trusted:n}}_getAllState(){return[this._trustedCells,this._totalCells,this.activeCellTrusted]}_triggerChange(e,t){e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]||this.stateChanged.emit(void 0)}}e.Model=t}(at||(at={}));class lt extends Te.ABCWidgetFactory{constructor(e){super(e),this.rendermime=e.rendermime,this.contentFactory=e.contentFactory||et.defaultContentFactory,this.mimeTypeService=e.mimeTypeService,this._editorConfig=e.editorConfig||Ye.defaultEditorConfig,this._notebookConfig=e.notebookConfig||Ye.defaultNotebookConfig,this._sessionDialogs=e.sessionDialogs||o.sessionContextDialogs}get editorConfig(){return this._editorConfig}set editorConfig(e){this._editorConfig=e}get notebookConfig(){return this._notebookConfig}set notebookConfig(e){this._notebookConfig=e}createNewWidget(e,t){const n={rendermime:t?t.content.rendermime:this.rendermime.clone({resolver:e.urlResolver}),contentFactory:this.contentFactory,mimeTypeService:this.mimeTypeService,editorConfig:t?t.content.editorConfig:this._editorConfig,notebookConfig:t?t.content.notebookConfig:this._notebookConfig,translator:this.translator},o=this.contentFactory.createNotebook(n);return new et({context:e,content:o})}defaultToolbarFactory(e){return ge.getDefaultItems(e,this._sessionDialogs,this.translator)}}var dt=n(70988);function rt(e){const t=e.translator||de.nullTranslator,n=(0,o.translateKernelStatuses)(t),s=t.load("jupyterlab"),i=e.state,a=e.displayOption.showOnToolBar,l=e.displayOption.showProgress,d=a?"down":"up",r=N().createElement("div",null);if(!i)return r;const c=i.kernelStatus,h={alignSelf:"normal",height:"24px"},u=i.totalTime,g=i.scheduledCellNumber||0,p=g-(i.scheduledCell.size||0);let m=100*p/g,C=l?"":"hidden";!l&&m<100&&(m=0);const _=e=>N().createElement(we._3,{progress:e,width:16,height:24}),v=e=>s.__("Kernel status: %1",e),f=(e,t,o)=>N().createElement("div",{className:"jp-Notebook-ExecutionIndicator",title:l?"":v(n[e]),"data-status":e},t,N().createElement("div",{className:`jp-Notebook-ExecutionIndicator-tooltip ${d} ${C}`},N().createElement("span",null," ",v(n[e])," "),o));if("connecting"===i.kernelStatus||"disconnected"===i.kernelStatus||"unknown"===i.kernelStatus)return f(c,N().createElement(S.offlineBoltIcon.react,Object.assign({},h)),[]);if("starting"===i.kernelStatus||"terminating"===i.kernelStatus||"restarting"===i.kernelStatus||"initializing"===i.kernelStatus)return f(c,N().createElement(S.circleIcon.react,Object.assign({},h)),[]);if("busy"===i.executionStatus)return f("busy",_(m),[N().createElement("span",{key:0},s.__(`Executed ${p}/${g} cells`)),N().createElement("span",{key:1},s._n("Elapsed time: %1 second","Elapsed time: %1 seconds",u))]);{const e="busy"===i.kernelStatus?0:100,t="busy"===i.kernelStatus||0===u?[]:[N().createElement("span",{key:0},s._n("Executed %1 cell","Executed %1 cells",g)),N().createElement("span",{key:1},s._n("Elapsed time: %1 second","Elapsed time: %1 seconds",u))];return f(i.kernelStatus,_(e),t)}}class ct extends o.VDomRenderer{constructor(e,t=!0){super(new ct.Model),this.translator=e||de.nullTranslator,this.addClass(we.t6)}render(){if(null!==this.model&&this.model.renderFlag){const e=this.model.currentNotebook;return e?N().createElement(rt,{displayOption:this.model.displayOption,state:this.model.executionState(e),translator:this.translator}):N().createElement(rt,{displayOption:this.model.displayOption,state:void 0,translator:this.translator})}return N().createElement("div",null)}}!function(e){class t extends o.VDomModel{constructor(){super(),this._notebookExecutionProgress=new WeakMap,this._displayOption={showOnToolBar:!0,showProgress:!0},this._renderFlag=!0}attachNotebook(e){var t,n,o,s;if(e&&e.content&&e.context){const i=e.content,a=e.context;if(this._currentNotebook=i,!this._notebookExecutionProgress.has(i)){this._notebookExecutionProgress.set(i,{executionStatus:"idle",kernelStatus:"idle",totalTime:0,interval:0,timeout:0,scheduledCell:new Set,scheduledCellNumber:0,needReset:!0});const e=this._notebookExecutionProgress.get(i),l=t=>{e&&(e.kernelStatus=t.kernelDisplayStatus),this.stateChanged.emit(void 0)};a.statusChanged.connect(l,this);const d=t=>{e&&(e.kernelStatus=t.kernelDisplayStatus),this.stateChanged.emit(void 0)};a.connectionStatusChanged.connect(d,this),a.disposed.connect((e=>{e.connectionStatusChanged.disconnect(d,this),e.statusChanged.disconnect(l,this)}));const r=(e,t)=>{const n=t.msg,o=n.header.msg_id;if("execute_request"===n.header.msg_type)this._cellScheduledCallback(i,o);else if(dt.KernelMessage.isStatusMsg(n)&&"idle"===n.content.execution_state){const e=n.parent_header.msg_id;this._cellExecutedCallback(i,e)}else"execute_input"===n.header.msg_type&&this._startTimer(i)};null===(n=null===(t=a.session)||void 0===t?void 0:t.kernel)||void 0===n||n.anyMessage.connect(r),null===(s=null===(o=a.session)||void 0===o?void 0:o.kernel)||void 0===s||s.disposed.connect((e=>e.anyMessage.disconnect(r)));const c=(t,n)=>{e&&(this._resetTime(e),this.stateChanged.emit(void 0),n.newValue&&n.newValue.anyMessage.connect(r))};a.kernelChanged.connect(c),a.disposed.connect((e=>e.kernelChanged.disconnect(c)))}}}get currentNotebook(){return this._currentNotebook}get displayOption(){return this._displayOption}set displayOption(e){this._displayOption=e}executionState(e){return this._notebookExecutionProgress.get(e)}_cellExecutedCallback(e,t){const n=this._notebookExecutionProgress.get(e);n&&n.scheduledCell.has(t)&&(n.scheduledCell.delete(t),0===n.scheduledCell.size&&(window.setTimeout((()=>{n.executionStatus="idle",clearInterval(n.interval),this.stateChanged.emit(void 0)}),150),n.timeout=window.setTimeout((()=>{n.needReset=!0}),1e3)))}_startTimer(e){const t=this._notebookExecutionProgress.get(e);t&&"busy"!==t.executionStatus&&(t.executionStatus="busy",clearTimeout(t.timeout),this.stateChanged.emit(void 0),t.interval=window.setInterval((()=>{this._tick(t)}),1e3))}_cellScheduledCallback(e,t){const n=this._notebookExecutionProgress.get(e);n&&!n.scheduledCell.has(t)&&(n.needReset&&this._resetTime(n),n.scheduledCell.add(t),n.scheduledCellNumber+=1)}_tick(e){e.totalTime+=1,this.stateChanged.emit(void 0)}_resetTime(e){e.totalTime=0,e.scheduledCellNumber=0,e.executionStatus="idle",e.scheduledCell=new Set,clearTimeout(e.timeout),clearInterval(e.interval),e.needReset=!1}get renderFlag(){return this._renderFlag}updateRenderOption(e){this.displayOption.showOnToolBar&&(e.showOnToolBar?this._renderFlag=!0:this._renderFlag=!1),this.displayOption.showProgress=e.showProgress,this.stateChanged.emit(void 0)}}function n(e){let t=!0,n=!0;const o=e.get("kernelStatus").composite;return o&&(t=!o.showOnStatusBar,n=o.showProgress),{showOnToolBar:t,showProgress:n}}e.Model=t,e.createExecutionIndicatorItem=function(t,o,s){const i=new e(o);return i.model.displayOption={showOnToolBar:!0,showProgress:!0},i.model.attachNotebook({content:t.content,context:t.sessionContext}),s&&s.then((e=>{const t=e=>{i.model.updateRenderOption(n(e))};e.changed.connect(t),t(e),i.disposed.connect((()=>{e.changed.disconnect(t)}))})).catch((e=>{console.error(e.message)})),i},e.getSettingValue=n}(ct||(ct={}))}}]);